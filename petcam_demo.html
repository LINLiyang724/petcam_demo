// ==========================================
        // ğŸŸ¢ Onboarding (å«é…ç½‘å¤±è´¥/é‡è¯•é€»è¾‘)
        // ==========================================
        
        const Onboarding = ({ onComplete }) => {
            const [step, setStep] = useState(0); 
            const [connectStatus, setConnectStatus] = useState('idle'); // idle, scanning, connecting, success, failed
            const [failReason, setFailReason] = useState(''); // å¤±è´¥åŸå› æ–‡æ¡ˆ
            
            // å·²æ·»åŠ çš„å® ç‰©åˆ—è¡¨
            const [addedPets, setAddedPets] = useState([]);
            // å½“å‰è¡¨å•
            const [formData, setFormData] = useState({ petName: '', petBreed: '', petWeight: '' });

            // ... (å® ç‰©æ·»åŠ é€»è¾‘ä¿æŒä¸å˜ï¼Œä¸ºäº†èŠ‚çœç¯‡å¹…çœç•¥ï¼Œç›´æ¥å¤åˆ¶ä¹‹å‰çš„ handleAddAnother ç­‰å‡½æ•°å³å¯) ...
            const handleAddAnother = () => {
                if (!formData.petName) return;
                setAddedPets([...addedPets, { ...formData, id: Date.now() }]);
                setFormData({ petName: '', petBreed: '', petWeight: '' });
            };
            const handleRemovePet = (id) => setAddedPets(addedPets.filter(p => p.id !== id));
            const handleNextFromProfile = () => {
                let finalPets = [...addedPets];
                if (formData.petName) finalPets.push({ ...formData, id: Date.now() });
                if (finalPets.length === 0) return alert("è¯·è‡³å°‘æ·»åŠ ä¸€åªå® ç‰©å“¦~");
                setAddedPets(finalPets);
                setStep(4);
            };

            // ğŸŒŸ æ ¸å¿ƒä¿®æ”¹ï¼šé…ç½‘é€»è¾‘ (åŒ…å«éšæœºå¤±è´¥)
            const handleConnect = () => {
                setConnectStatus('scanning');
                setFailReason(''); // é‡ç½®é”™è¯¯ä¿¡æ¯
                
                // 1. æ¨¡æ‹Ÿæ‰«æé˜¶æ®µ
                setTimeout(() => {
                    setConnectStatus('connecting');
                    
                    // 2. æ¨¡æ‹Ÿè¿æ¥é˜¶æ®µ (2ç§’åå‡ºç»“æœ)
                    setTimeout(() => {
                        // ğŸ² éšæœºç”Ÿæˆç»“æœï¼š50% æˆåŠŸï¼Œ50% å¤±è´¥
                        const isSuccess = Math.random() > 0.5;
                        
                        if (isSuccess) {
                            setConnectStatus('success');
                        } else {
                            setConnectStatus('failed');
                            // éšæœºç»™ä¸€ä¸ªå¤±è´¥ç†ç”±ï¼Œå¢åŠ çœŸå®æ„Ÿ
                            const reasons = [
                                "æœªæ‰«æåˆ°è®¾å¤‡ï¼Œè¯·æ£€æŸ¥è“ç¯æ˜¯å¦é—ªçƒ",
                                "WiFi å¯†ç éªŒè¯å¤±è´¥",
                                "è®¾å¤‡è¿æ¥è¶…æ—¶ï¼Œè¯·é è¿‘é‡è¯•"
                            ];
                            setFailReason(reasons[Math.floor(Math.random() * reasons.length)]);
                        }
                    }, 2500);
                }, 1500); 
            };

            // ğŸŒŸ æ ¸å¿ƒä¿®æ”¹ï¼šé‡ç½®å¹¶è¿”å›ä¸Šä¸€æ­¥
            const handleReset = () => {
                setConnectStatus('idle');
                setFailReason('');
            };

            // Step 0 & 1 ä¿æŒä¸å˜...
            if (step === 0) return <div className="h-screen bg-orange-500 flex flex-col items-center justify-center text-white relative overflow-hidden cursor-pointer" onClick={() => setStep(1)}><div className="bg-white p-4 rounded-3xl mb-6 shadow-2xl animate-fade-in"><Cat size={64} className="text-orange-500" /></div><h1 className="text-4xl font-extrabold tracking-tight mb-2 animate-fade-in">PetGuard</h1><p className="opacity-90 animate-fade-in">AI é©±åŠ¨çš„æ™ºèƒ½å…»å® ä¸“å®¶</p><div className="absolute bottom-10 text-sm opacity-60 animate-pulse">ç‚¹å‡»å±å¹•å¼€å§‹ä½“éªŒ</div></div>;

            if (step === 1) return <div className="h-screen bg-gray-50 max-w-md mx-auto flex flex-col p-6 pt-20 animate-fade-in"><h1 className="text-3xl font-bold text-gray-900 mb-2">æ¬¢è¿å›æ¥ ğŸ‘‹</h1><p className="text-gray-500 mb-8">ç™»å½•ä»¥è¿æ¥æ‚¨çš„ PetGuard è®¾å¤‡</p><div className="space-y-4"><div className="relative"><Mail className="absolute left-4 top-3.5 text-gray-400" size={20} /><input type="email" placeholder="é‚®ç®±åœ°å€" className="w-full pl-12 pr-4 py-3 bg-white border border-gray-200 rounded-xl focus:outline-none focus:border-orange-500 transition-all" /></div><div className="relative"><Lock className="absolute left-4 top-3.5 text-gray-400" size={20} /><input type="password" placeholder="å¯†ç " className="w-full pl-12 pr-4 py-3 bg-white border border-gray-200 rounded-xl focus:outline-none focus:border-orange-500 transition-all" /></div></div><div className="mt-auto mb-6"><button onClick={() => setStep(2)} className="w-full bg-orange-500 text-white font-bold py-4 rounded-full shadow-lg hover:bg-orange-600 active:scale-95 transition-all">ç™»å½• / æ³¨å†Œ</button></div></div>;

            // ğŸŒŸ Step 2: é…ç½‘é¡µé¢ (å¤§å¹…ä¿®æ”¹ UI)
            if (step === 2) return (
                <div className="h-screen bg-gray-50 max-w-md mx-auto flex flex-col p-6 pt-10 animate-fade-in">
                    <div className="flex justify-between items-center mb-6">
                        <h2 className="text-2xl font-bold">æ·»åŠ è®¾å¤‡</h2>
                        <span className="text-xs font-mono text-orange-500 bg-orange-50 px-2 py-1 rounded">Step 1/3</span>
                    </div>

                    <div className="flex-1 flex flex-col items-center justify-center relative">
                        {/* çŠ¶æ€åœ†åœˆ */}
                        <div className={`w-64 h-64 rounded-full border-2 flex items-center justify-center relative transition-all duration-500 ${
                            connectStatus === 'success' ? 'border-green-500 bg-green-50' : 
                            connectStatus === 'failed' ? 'border-red-500 bg-red-50' : 'border-orange-100'
                        }`}>
                            {connectStatus === 'scanning' && <div className="absolute inset-0 rounded-full border-4 border-orange-200 animate-pulse-ring"></div>}
                            
                            {/* å›¾æ ‡çŠ¶æ€æœº */}
                            {connectStatus === 'idle' && <Camera size={64} className="text-gray-300" />}
                            {(connectStatus === 'scanning' || connectStatus === 'connecting') && <Wifi size={64} className="text-orange-500 animate-pulse" />}
                            {connectStatus === 'success' && <Check size={64} className="text-green-500 animate-in zoom-in" />}
                            {connectStatus === 'failed' && <AlertTriangle size={64} className="text-red-500 animate-in zoom-in" />}
                        </div>

                        {/* æ–‡æœ¬æç¤ºçŠ¶æ€æœº */}
                        <div className="mt-8 text-center space-y-2 px-4">
                            <h3 className={`text-xl font-bold ${connectStatus === 'failed' ? 'text-red-600' : 'text-gray-800'}`}>
                                {connectStatus === 'idle' ? 'å¼€å¯è®¾å¤‡è“ç‰™' : 
                                 connectStatus === 'scanning' ? 'æ­£åœ¨æœç´¢è®¾å¤‡...' :
                                 connectStatus === 'connecting' ? 'æ­£åœ¨åŒæ­¥ WiFi ä¿¡æ¯...' :
                                 connectStatus === 'success' ? 'è¿æ¥æˆåŠŸï¼' : 'è¿æ¥å¤±è´¥'}
                            </h3>
                            <p className="text-sm text-gray-500">
                                {connectStatus === 'idle' && 'è¯·ç¡®ä¿è®¾å¤‡å·²æ¥é€šç”µæºï¼ŒæŒ‡ç¤ºç¯é—ªçƒè“å…‰'}
                                {connectStatus === 'success' && 'è®¾å¤‡ ID: PG-Cam-8821 å·²ä¸Šçº¿'}
                                {connectStatus === 'failed' && failReason}
                            </p>
                        </div>

                        {/* å¤±è´¥æ—¶çš„é¢å¤–å¸®åŠ©ä¿¡æ¯ */}
                        {connectStatus === 'failed' && (
                            <div className="mt-6 bg-white p-3 rounded-lg border border-red-100 text-xs text-gray-500 w-full animate-slide-up">
                                <div className="font-bold text-gray-700 mb-1">ğŸ’¡ æ’æŸ¥å»ºè®®ï¼š</div>
                                <ul className="list-disc pl-4 space-y-1">
                                    <li>æ£€æŸ¥ WiFi å¯†ç æ˜¯å¦æ­£ç¡®</li>
                                    <li>æš‚ä¸æ”¯æŒ 5G é¢‘æ®µ WiFi</li>
                                    <li>è¯·é•¿æŒ‰è®¾å¤‡ Reset é”® 5 ç§’é‡ç½®</li>
                                </ul>
                            </div>
                        )}
                    </div>

                    {/* åº•éƒ¨æŒ‰é’®ç»„ */}
                    <div className="mt-auto mb-6 space-y-3">
                        {connectStatus === 'idle' ? (
                            <button onClick={handleConnect} className="w-full bg-gray-900 text-white font-bold py-4 rounded-full shadow-lg hover:bg-gray-800 transition-all">æœç´¢è®¾å¤‡</button>
                        ) : connectStatus === 'success' ? (
                            <button onClick={() => setStep(3)} className="w-full bg-green-500 text-white font-bold py-4 rounded-full shadow-lg hover:bg-green-600 transition-all flex items-center justify-center gap-2">ä¸‹ä¸€æ­¥ <ChevronRight size={20}/></button>
                        ) : connectStatus === 'failed' ? (
                            <div className="space-y-3 animate-slide-up">
                                <button onClick={handleConnect} className="w-full bg-orange-500 text-white font-bold py-4 rounded-full shadow-lg hover:bg-orange-600 transition-all flex items-center justify-center gap-2">
                                    <Wifi size={20}/> é‡è¯•
                                </button>
                                <div className="grid grid-cols-2 gap-3">
                                    <button onClick={handleReset} className="w-full bg-white border border-gray-200 text-gray-600 font-bold py-3 rounded-xl hover:bg-gray-50 transition-all text-sm">
                                        è¿”å›ä¸Šä¸€æ­¥
                                    </button>
                                    <button onClick={() => alert("æ¨¡æ‹Ÿè¿›å…¥æ‰«ç æ¨¡å¼")} className="w-full bg-white border border-gray-200 text-gray-600 font-bold py-3 rounded-xl hover:bg-gray-50 transition-all text-sm">
                                        å°è¯•æ‰«ç è¿æ¥
                                    </button>
                                </div>
                            </div>
                        ) : (
                            <button disabled className="w-full bg-gray-100 text-gray-400 font-bold py-4 rounded-full cursor-not-allowed flex items-center justify-center gap-2"><Loader2 className="animate-spin" size={20}/> è¿æ¥ä¸­...</button>
                        )}
                    </div>
                </div>
            );

            // Step 3 & 4 ä¿æŒä¸å˜ (ä¸ºäº†å®Œæ•´æ€§ï¼Œè¿™é‡Œç®€å†™ï¼Œè¯·ç›´æ¥ä½¿ç”¨ä½ ä¸Šä¸€ä¸ªç‰ˆæœ¬ Step 3/4 çš„ä»£ç ï¼Œæˆ–è€…æˆ‘å†æ¬¡å®Œæ•´è´´å‡º)
            if (step === 3) return <div className="h-screen bg-gray-50 max-w-md mx-auto flex flex-col p-6 pt-10 animate-fade-in overflow-y-auto"><div className="flex justify-between items-center mb-6"><h2 className="text-2xl font-bold">è°æ˜¯å°ä¸»è§’ï¼Ÿ</h2><span className="text-xs font-mono text-orange-500 bg-orange-50 px-2 py-1 rounded">Step 2/3</span></div>{addedPets.length > 0 && (<div className="flex gap-2 flex-wrap mb-6 animate-fade-in">{addedPets.map(pet => (<div key={pet.id} className="bg-orange-100 text-orange-700 px-3 py-1.5 rounded-full text-xs font-bold flex items-center gap-2 shadow-sm border border-orange-200"><Cat size={14}/> {pet.petName}<button onClick={() => handleRemovePet(pet.id)} className="text-orange-400 hover:text-red-500"><X size={14}/></button></div>))}</div>)}<div className="space-y-6 flex-1"><div className="flex justify-center"><div className="w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center border-2 border-dashed border-gray-300 text-gray-400"><Camera size={24}/></div></div><div className="space-y-4"><div><label className="text-xs font-bold text-gray-700 ml-1 mb-1 block">åå­—</label><div className="relative"><Cat className="absolute left-4 top-3.5 text-gray-400" size={18} /><input type="text" placeholder="ä¾‹å¦‚ï¼šæ —å­" value={formData.petName} onChange={e => setFormData({...formData, petName: e.target.value})} className="w-full pl-12 pr-4 py-3 bg-white border border-gray-200 rounded-xl focus:outline-none focus:border-orange-500 transition-all" /></div></div><div className="grid grid-cols-2 gap-4"><div><label className="text-xs font-bold text-gray-700 ml-1 mb-1 block">å“ç§</label><div className="relative"><div className="absolute left-4 top-3.5 text-gray-400"><Ruler size={18}/></div><input type="text" placeholder="å¦‚ï¼šç¾çŸ­" value={formData.petBreed} onChange={e => setFormData({...formData, petBreed: e.target.value})} className="w-full pl-12 pr-4 py-3 bg-white border border-gray-200 rounded-xl focus:outline-none focus:border-orange-500 transition-all" /></div></div><div><label className="text-xs font-bold text-gray-700 ml-1 mb-1 block">ä½“é‡ (kg)</label><div className="relative"><div className="absolute left-4 top-3.5 text-gray-400"><Scale size={18}/></div><input type="number" placeholder="0.0" value={formData.petWeight} onChange={e => setFormData({...formData, petWeight: e.target.value})} className="w-full pl-12 pr-4 py-3 bg-white border border-gray-200 rounded-xl focus:outline-none focus:border-orange-500 transition-all" /></div></div></div></div><button onClick={handleAddAnother} disabled={!formData.petName} className={`w-full border-2 border-dashed border-gray-300 text-gray-400 font-bold py-3 rounded-xl hover:border-orange-400 hover:text-orange-500 transition-all flex items-center justify-center gap-2 ${!formData.petName ? 'opacity-50 cursor-not-allowed' : ''}`}><Plus size={20}/> ä¿å­˜å½“å‰å¹¶æ·»åŠ ä¸‹ä¸€åª</button></div><div className="mt-8 mb-6"><button onClick={handleNextFromProfile} disabled={addedPets.length === 0 && !formData.petName} className={`w-full font-bold py-4 rounded-full shadow-lg transition-all flex items-center justify-center gap-2 ${addedPets.length > 0 || formData.petName ? 'bg-orange-500 text-white hover:bg-orange-600' : 'bg-gray-200 text-gray-400 cursor-not-allowed'}`}>{addedPets.length > 0 ? `å®Œæˆè®¾ç½® (${addedPets.length + (formData.petName?1:0)} åªå® ç‰©)` : 'ä¸‹ä¸€æ­¥'} <ChevronRight size={20}/></button></div></div>;

            if (step === 4) return <div className="h-screen bg-gray-50 max-w-md mx-auto flex flex-col p-6 pt-10 animate-fade-in"><div className="flex justify-between items-center mb-6"><h2 className="text-2xl font-bold">æœ€åä¸€æ­¥</h2><span className="text-xs font-mono text-orange-500 bg-orange-50 px-2 py-1 rounded">Step 3/3</span></div><div className="space-y-4"><div className="bg-white p-4 rounded-2xl border border-orange-200 shadow-sm flex items-center gap-4 relative overflow-hidden"><div className="absolute left-0 top-0 bottom-0 w-1 bg-orange-500"></div><div className="bg-orange-100 p-3 rounded-full text-orange-600"><Bell size={24}/></div><div className="flex-1"><h4 className="font-bold text-gray-900">å¼‚å¸¸é€šçŸ¥</h4><p className="text-xs text-gray-500 mt-1">æ¥æ”¶å‘•åã€æ‰“æ¶è­¦æŠ¥ã€‚</p></div><div className="relative inline-flex h-6 w-11 items-center rounded-full bg-orange-500"><span className="translate-x-6 inline-block h-4 w-4 transform rounded-full bg-white transition"/></div></div></div><div className="mt-auto mb-6"><button onClick={() => onComplete(addedPets)} className="w-full bg-gray-900 text-white font-bold py-4 rounded-full shadow-lg hover:bg-gray-800 transition-all flex items-center justify-center gap-2">å¼€å¯å®ˆæŠ¤ä¹‹æ—… <Check size={20}/></button></div></div>;
        };
