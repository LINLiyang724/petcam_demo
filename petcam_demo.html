<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PetGuard å®Œæ•´æ¼”ç¤º (ä¿®å¤ç‰ˆ)</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.344.0"
      }
    }
    </script>

    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* åŸºç¡€æ ·å¼ */
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        
        /* åŠ¨ç”»å…³é”®å¸§ */
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .animate-fade-in { animation: fadeIn 0.5s ease-out; }
        
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .animate-slide-up { animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1); }

        @keyframes pulse-ring { 0% { transform: scale(0.8); opacity: 0.5; } 100% { transform: scale(1.5); opacity: 0; } }
        .animate-pulse-ring { animation: pulse-ring 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }

        /* åŠ è½½çŠ¶æ€æ ·å¼ */
        #loading-screen {
            position: fixed; inset: 0; background: #f3f4f6; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            z-index: 9999; color: #4b5563; transition: opacity 0.5s;
        }
        /* é”™è¯¯æç¤ºæ ·å¼ */
        #error-console {
            display: none; position: fixed; top: 0; left: 0; right: 0; padding: 20px;
            background: #fee2e2; color: #b91c1c; border-bottom: 2px solid #ef4444; z-index: 10000;
            font-family: monospace; font-size: 12px; white-space: pre-wrap;
        }
    </style>
</head>
<body class="bg-gray-100">
    
    <div id="error-console"></div>

    <div id="loading-screen">
        <div class="w-12 h-12 border-4 border-orange-200 border-t-orange-500 rounded-full animate-spin mb-4"></div>
        <p>æ­£åœ¨åˆå§‹åŒ– PetGuard...</p>
        <p style="font-size: 10px; margin-top: 10px; opacity: 0.6;">å¦‚æœé•¿æ—¶é—´å¡ä½ï¼Œè¯·å°è¯•ä½¿ç”¨ VS Code Live Server æ‰“å¼€</p>
    </div>

    <div id="root"></div>

    <script>
        window.onerror = function(msg, url, line, col, error) {
            const errorBox = document.getElementById('error-console');
            const loadingBox = document.getElementById('loading-screen');
            errorBox.style.display = 'block';
            loadingBox.style.display = 'none';
            
            let tip = "";
            if (String(msg).includes("Script error") || String(msg).includes("Import")) {
                tip = "\nğŸ‘‰ æç¤ºï¼šè¿™é€šå¸¸æ˜¯å› ä¸ºç›´æ¥åŒå‡» HTML æ–‡ä»¶å¯¼è‡´çš„å®‰å…¨é™åˆ¶ã€‚\nè¯·å°è¯•åœ¨ VS Code ä¸­å®‰è£… 'Live Server' æ’ä»¶ï¼Œç„¶åå³é”®é€‰æ‹© 'Open with Live Server'ã€‚";
            }
            
            errorBox.innerText = "âš ï¸ ç¨‹åºå‘ç”Ÿé”™è¯¯:\n" + msg + "\n" + tip;
            return false;
        };
    </script>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        // ä¿®å¤ï¼šç§»é™¤å¯èƒ½æ”¹åçš„ HelpCircleï¼Œä½¿ç”¨é€šç”¨å›¾æ ‡
        import { 
            Camera, Activity, Bell, Settings, Play, Pause, AlertTriangle, Clock, X, 
            Sparkles, Utensils, Moon, Footprints, Upload, Volume2, VolumeX, Eye, 
            Radio, MessageCircle, Send, User, Bot, Filter, ZoomIn, PlayCircle, Film, 
            Loader2, Wifi, Battery, ChevronRight, Edit2, Shield, Droplets, Calendar, 
            BarChart2, ChevronLeft, Minimize2, ShoppingBag, HeartPulse, Lightbulb, CheckCircle,
            Mail, Lock, Cat, Scale, Ruler, Mic, ShieldCheck, Check, Plus, Trash2, HelpCircle as CircleHelp
        } from 'lucide-react';

        // ç§»é™¤åŠ è½½å±
        setTimeout(() => {
            const loader = document.getElementById('loading-screen');
            if(loader) loader.style.opacity = '0';
            setTimeout(() => loader && loader.remove(), 500);
        }, 500);

        // ==========================================
        // ğŸŸ¢ æ¨¡å—ä¸€ï¼šOnboarding
        // ==========================================
        
        const Onboarding = ({ onComplete }) => {
            const [step, setStep] = useState(0); 
            const [connectStatus, setConnectStatus] = useState('idle');
            const [failReason, setFailReason] = useState('');
            const [addedPets, setAddedPets] = useState([]);
            const [formData, setFormData] = useState({ petName: '', petBreed: '', petWeight: '' });

            const handleAddAnother = () => {
                if (!formData.petName) return;
                const newPet = { ...formData, id: Date.now() }; 
                setAddedPets([...addedPets, newPet]);
                setFormData({ petName: '', petBreed: '', petWeight: '' }); 
            };

            const handleRemovePet = (id) => setAddedPets(addedPets.filter(p => p.id !== id));

            const handleNextFromProfile = () => {
                let finalPets = [...addedPets];
                if (formData.petName) finalPets.push({ ...formData, id: Date.now() });
                if (finalPets.length === 0) return alert("è¯·è‡³å°‘æ·»åŠ ä¸€åªå® ç‰©å“¦~");
                setAddedPets(finalPets);
                setStep(4); 
            };

            const handleConnect = () => {
                setConnectStatus('scanning');
                setFailReason('');
                setTimeout(() => {
                    setConnectStatus('connecting');
                    setTimeout(() => {
                        const isSuccess = Math.random() > 0.5;
                        if (isSuccess) setConnectStatus('success');
                        else {
                            setConnectStatus('failed');
                            const reasons = ["æœªæ‰«æåˆ°è®¾å¤‡", "WiFi å¯†ç é”™è¯¯", "è¿æ¥è¶…æ—¶"];
                            setFailReason(reasons[Math.floor(Math.random() * reasons.length)]);
                        }
                    }, 2000);
                }, 1500); 
            };

            if (step === 0) return <div className="h-screen bg-orange-500 flex flex-col items-center justify-center text-white cursor-pointer" onClick={() => setStep(1)}><div className="bg-white p-4 rounded-3xl mb-6 shadow-2xl animate-fade-in"><Cat size={64} className="text-orange-500" /></div><h1 className="text-4xl font-extrabold mb-2 animate-fade-in">PetGuard</h1><p className="opacity-90 animate-fade-in">AI é©±åŠ¨çš„æ™ºèƒ½å…»å® ä¸“å®¶</p><div className="absolute bottom-10 text-sm opacity-60 animate-pulse">ç‚¹å‡»å±å¹•å¼€å§‹ä½“éªŒ</div></div>;

            if (step === 1) return <div className="h-screen bg-gray-50 max-w-md mx-auto flex flex-col p-6 pt-20 animate-fade-in"><h1 className="text-3xl font-bold text-gray-900 mb-2">æ¬¢è¿å›æ¥ ğŸ‘‹</h1><p className="text-gray-500 mb-8">ç™»å½•ä»¥è¿æ¥æ‚¨çš„ PetGuard è®¾å¤‡</p><div className="space-y-4"><div className="relative"><Mail className="absolute left-4 top-3.5 text-gray-400" size={20} /><input type="email" placeholder="é‚®ç®±" className="w-full pl-12 pr-4 py-3 bg-white border border-gray-200 rounded-xl" /></div><div className="relative"><Lock className="absolute left-4 top-3.5 text-gray-400" size={20} /><input type="password" placeholder="å¯†ç " className="w-full pl-12 pr-4 py-3 bg-white border border-gray-200 rounded-xl" /></div></div><div className="mt-auto mb-6"><button onClick={() => setStep(2)} className="w-full bg-orange-500 text-white font-bold py-4 rounded-full shadow-lg">ç™»å½• / æ³¨å†Œ</button></div></div>;

            if (step === 2) return (
                <div className="h-screen bg-gray-50 max-w-md mx-auto flex flex-col p-6 pt-10 animate-fade-in">
                    <div className="flex justify-between items-center mb-6"><h2 className="text-2xl font-bold">æ·»åŠ è®¾å¤‡</h2><span className="text-xs font-mono text-orange-500 bg-orange-50 px-2 py-1 rounded">Step 1/3</span></div>
                    <div className="flex-1 flex flex-col items-center justify-center relative">
                        <div className={`w-64 h-64 rounded-full border-2 flex items-center justify-center relative transition-all duration-500 ${connectStatus === 'success' ? 'border-green-500 bg-green-50' : connectStatus === 'failed' ? 'border-red-500 bg-red-50' : 'border-orange-100'}`}>
                            {connectStatus === 'scanning' && <div className="absolute inset-0 rounded-full border-4 border-orange-200 animate-pulse-ring"></div>}
                            {connectStatus === 'idle' && <Camera size={64} className="text-gray-300" />}
                            {(connectStatus === 'scanning' || connectStatus === 'connecting') && <Wifi size={64} className="text-orange-500 animate-pulse" />}
                            {connectStatus === 'success' && <Check size={64} className="text-green-500 animate-in zoom-in" />}
                            {connectStatus === 'failed' && <AlertTriangle size={64} className="text-red-500 animate-in zoom-in" />}
                        </div>
                        <div className="mt-8 text-center space-y-2">
                            <h3 className={`text-xl font-bold ${connectStatus === 'failed' ? 'text-red-600' : 'text-gray-800'}`}>{connectStatus === 'idle' ? 'å¼€å¯è®¾å¤‡è“ç‰™' : connectStatus === 'failed' ? 'è¿æ¥å¤±è´¥' : connectStatus === 'success' ? 'è¿æ¥æˆåŠŸ' : 'æ­£åœ¨æœç´¢...'}</h3>
                            <p className="text-sm text-gray-500">{connectStatus === 'failed' ? failReason : connectStatus === 'idle' ? 'è¯·ç¡®ä¿è“ç¯é—ªçƒ' : ''}</p>
                        </div>
                    </div>
                    <div className="mt-auto mb-6 space-y-3">
                        {connectStatus === 'idle' ? <button onClick={handleConnect} className="w-full bg-gray-900 text-white font-bold py-4 rounded-full shadow-lg">æœç´¢è®¾å¤‡</button> :
                         connectStatus === 'success' ? <button onClick={() => setStep(3)} className="w-full bg-green-500 text-white font-bold py-4 rounded-full shadow-lg flex items-center justify-center gap-2">ä¸‹ä¸€æ­¥ <ChevronRight size={20}/></button> :
                         connectStatus === 'failed' ? <div className="space-y-3"><button onClick={handleConnect} className="w-full bg-orange-500 text-white font-bold py-4 rounded-full shadow-lg">é‡è¯•</button><button onClick={() => setStep(1)} className="w-full bg-white border border-gray-200 text-gray-600 font-bold py-3 rounded-xl">è¿”å›ä¸Šä¸€æ­¥</button></div> :
                         <button disabled className="w-full bg-gray-100 text-gray-400 font-bold py-4 rounded-full cursor-not-allowed flex items-center justify-center gap-2"><Loader2 className="animate-spin" size={20}/> è¿æ¥ä¸­...</button>}
                    </div>
                </div>
            );

            if (step === 3) return (
                <div className="h-screen bg-gray-50 max-w-md mx-auto flex flex-col p-6 pt-10 animate-fade-in overflow-y-auto">
                    <div className="flex justify-between items-center mb-6"><h2 className="text-2xl font-bold">å°ä¸»è§’</h2><span className="text-xs font-mono text-orange-500 bg-orange-50 px-2 py-1 rounded">Step 2/3</span></div>
                    {addedPets.length > 0 && (<div className="flex gap-2 flex-wrap mb-6">{addedPets.map(pet => (<div key={pet.id} className="bg-orange-100 text-orange-700 px-3 py-1.5 rounded-full text-xs font-bold flex items-center gap-2 border border-orange-200"><Cat size={14}/> {pet.petName}<button onClick={() => handleRemovePet(pet.id)}><X size={14}/></button></div>))}</div>)}
                    <div className="space-y-6 flex-1">
                        <div className="flex justify-center"><div className="w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center border-2 border-dashed border-gray-300 text-gray-400"><Camera size={24}/></div></div>
                        <div className="space-y-4">
                            <div><label className="text-xs font-bold text-gray-700 ml-1 mb-1 block">åå­—</label><div className="relative"><Cat className="absolute left-4 top-3.5 text-gray-400" size={18} /><input type="text" placeholder="ä¾‹å¦‚ï¼šæ —å­" value={formData.petName} onChange={e => setFormData({...formData, petName: e.target.value})} className="w-full pl-12 pr-4 py-3 bg-white border border-gray-200 rounded-xl" /></div></div>
                            <div className="grid grid-cols-2 gap-4">
                                <div><label className="text-xs font-bold text-gray-700 ml-1 mb-1 block">å“ç§</label><div className="relative"><div className="absolute left-4 top-3.5 text-gray-400"><Ruler size={18}/></div><input type="text" placeholder="ç¾çŸ­" value={formData.petBreed} onChange={e => setFormData({...formData, petBreed: e.target.value})} className="w-full pl-12 pr-4 py-3 bg-white border border-gray-200 rounded-xl" /></div></div>
                                <div><label className="text-xs font-bold text-gray-700 ml-1 mb-1 block">ä½“é‡ (kg)</label><div className="relative"><div className="absolute left-4 top-3.5 text-gray-400"><Scale size={18}/></div><input type="number" placeholder="0.0" value={formData.petWeight} onChange={e => setFormData({...formData, petWeight: e.target.value})} className="w-full pl-12 pr-4 py-3 bg-white border border-gray-200 rounded-xl" /></div></div>
                            </div>
                        </div>
                        <button onClick={handleAddAnother} disabled={!formData.petName} className={`w-full border-2 border-dashed border-gray-300 text-gray-400 font-bold py-3 rounded-xl flex items-center justify-center gap-2 ${!formData.petName ? 'opacity-50' : ''}`}><Plus size={20}/> ä¿å­˜å¹¶æ·»åŠ ä¸‹ä¸€åª</button>
                    </div>
                    <div className="mt-8 mb-6"><button onClick={handleNextFromProfile} disabled={addedPets.length === 0 && !formData.petName} className={`w-full font-bold py-4 rounded-full shadow-lg flex items-center justify-center gap-2 ${addedPets.length > 0 || formData.petName ? 'bg-orange-500 text-white' : 'bg-gray-200 text-gray-400'}`}>{addedPets.length > 0 ? 'å®Œæˆè®¾ç½®' : 'ä¸‹ä¸€æ­¥'} <ChevronRight size={20}/></button></div>
                </div>
            );

            if (step === 4) return <div className="h-screen bg-gray-50 max-w-md mx-auto flex flex-col p-6 pt-10 animate-fade-in"><div className="flex justify-between items-center mb-6"><h2 className="text-2xl font-bold">æƒé™</h2><span className="text-xs font-mono text-orange-500 bg-orange-50 px-2 py-1 rounded">Step 3/3</span></div><div className="space-y-4"><div className="bg-white p-4 rounded-2xl border border-orange-200 shadow-sm flex items-center gap-4 relative overflow-hidden"><div className="absolute left-0 top-0 bottom-0 w-1 bg-orange-500"></div><div className="bg-orange-100 p-3 rounded-full text-orange-600"><Bell size={24}/></div><div className="flex-1"><h4 className="font-bold text-gray-900">å¼‚å¸¸é€šçŸ¥</h4><p className="text-xs text-gray-500 mt-1">æ¥æ”¶å‘•åã€æ‰“æ¶è­¦æŠ¥ã€‚</p></div><div className="relative inline-flex h-6 w-11 items-center rounded-full bg-orange-500"><span className="translate-x-6 inline-block h-4 w-4 transform rounded-full bg-white transition"/></div></div></div><div className="mt-auto mb-6"><button onClick={() => onComplete(addedPets)} className="w-full bg-gray-900 text-white font-bold py-4 rounded-full shadow-lg flex items-center justify-center gap-2">å¼€å¯å®ˆæŠ¤ <Check size={20}/></button></div></div>;
        };

        // ==========================================
        // ğŸ”µ æ¨¡å—äºŒï¼šDashboard
        // ==========================================
        
        const Dashboard = ({ userPets }) => {
            const pet1 = userPets[0] || { petName: "æ —å­", petBreed: "ç‹¸èŠ±çŒ«", petWeight: "4.2" };
            const pet2 = userPets[1] || { petName: "å¥¶æ²¹", petBreed: "é‡‘æ¸å±‚é•¿æ¯›", petWeight: "5.5" }; 

            const mainPetName = pet1.petName;
            const secondPetName = pet2.petName;
            
            const [petData, setPetData] = useState({
                [mainPetName]: { 
                    type: pet1.petBreed || 'æœªçŸ¥å“ç§', weight: (pet1.petWeight || '?') + 'kg',
                    activeLevel: 92, eatCount: 2, drinkCount: 2, 
                    avatarColor: 'bg-gray-200 text-gray-700',
                    recentStatus: 'ç²¾åŠ›è¿‡å‰©',
                    report: `**ã€${mainPetName}æ—¥æŠ¥ã€‘**\nä»Šæ—¥æ ‡ç­¾ï¼š**ç²¾åŠ›è¿‡å‰©**ã€‚\n6ç‚¹åŠå°±å¼€å§‹**è·‘é…·**ã€‚`,
                    insight: `å»ºè®®ç¡å‰å¢åŠ  15 åˆ†é’Ÿé€—çŒ«æ£’äº’åŠ¨ã€‚`
                },
                [secondPetName]: { 
                    type: pet2.petBreed || 'æœªçŸ¥å“ç§', weight: (pet2.petWeight || '?') + 'kg',
                    activeLevel: 28, eatCount: 1, drinkCount: 1, 
                    avatarColor: 'bg-yellow-100 text-yellow-700',
                    recentStatus: 'è¿åŠ¨ä¸è¶³',
                    report: `**ã€${secondPetName}æ—¥æŠ¥ã€‘**\nä»Šæ—¥æ ‡ç­¾ï¼š**å²æœˆé™å¥½**ã€‚\nå‡ ä¹éƒ½åœ¨ç¡è§‰ã€‚`,
                    insight: `${secondPetName}æœ¬å‘¨æ´»è·ƒåº¦ä»… 30%ï¼Œå»ºè®®è¡¥å……ç©å…·ã€‚`
                }
            });

            const [logs, setLogs] = useState([
                { id: 10, time: '10:45', cat: 'åŒçŒ«', type: 'normal', action: 'è¿½é€æ‰“é—¹', detail: 'å®¢å…å‘ç”ŸçŸ­æ—¶è¿½é€', videoTime: null, thumbColor: 'bg-indigo-100' },
                { id: 9, time: '10:20', cat: mainPetName, type: 'normal', action: 'ç©è€', detail: 'ç‹¬è‡ªç©çŒ«è–„è·çƒ', videoTime: null, thumbColor: 'bg-orange-100' },
                { id: 8, time: '09:40', cat: secondPetName, type: 'normal', action: 'é¥®æ°´', detail: 'é¥®æ°´æœºå·¥ä½œæ­£å¸¸', videoTime: null, thumbColor: 'bg-blue-50' },
            ]);

            const [chatMessages, setChatMessages] = useState([
                { id: 1, type: 'bot', text: `ä½ å¥½ï¼PetGuard æ•°æ®æ˜¾ç¤ºï¼š${mainPetName}ä»Šå¤©æ´»åŠ›æ»¡æ»¡ï¼Œ${secondPetName}åˆ™æ¯”è¾ƒå®‰é™ã€‚`, time: '11:00' }
            ]);

            const [activeTab, setActiveTab] = useState('home');
            const [inputMessage, setInputMessage] = useState('');
            const [isAiThinking, setIsAiThinking] = useState(false);
            const chatContainerRef = useRef(null);

            useEffect(() => {
                if (chatContainerRef.current) chatContainerRef.current.scrollTop = chatContainerRef.current.scrollHeight;
            }, [chatMessages, activeTab]);

            const handleSendMessage = async (text = inputMessage) => {
                if (!text.trim()) return;
                setChatMessages(prev => [...prev, { id: Date.now(), type: 'user', text: text, time: 'åˆšåˆš' }]);
                setInputMessage('');
                setIsAiThinking(true);
                setTimeout(() => {
                    let response = `æˆ‘æ˜¯ PetGuardã€‚å…³äº${mainPetName}çš„æƒ…å†µï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹æ—¥æŠ¥ã€‚`;
                    if (text.includes("æ€»ç»“")) response = `${mainPetName}ä»Šå¤©ç²¾åŠ›æ—ºç››ï¼Œ${secondPetName}åœ¨ä¼‘æ¯ã€‚`;
                    setChatMessages(prev => [...prev, { id: Date.now() + 1, type: 'bot', text: response, time: 'åˆšåˆš' }]);
                    setIsAiThinking(false);
                }, 1000);
            };

            const formatText = (text) => {
                if (!text) return null;
                return text.split(/(\*\*.*?\*\*)/g).map((part, i) => part.startsWith('**') ? <strong key={i} className="text-indigo-700">{part.slice(2, -2)}</strong> : part);
            };

            const TabButton = ({ id, icon: Icon, label }) => (
                <button onClick={() => setActiveTab(id)} className={`flex flex-col items-center justify-center w-full py-2 ${activeTab === id ? 'text-orange-600' : 'text-gray-400'}`}>
                  <Icon size={24} className={`mb-1 ${activeTab === id ? 'scale-110' : ''} transition-transform`} />
                  <span className="text-[10px] font-medium">{label}</span>
                </button>
            );

            return (
                <div className="bg-gray-50 h-screen font-sans text-gray-900 flex flex-col max-w-md mx-auto shadow-2xl border-x border-gray-200 animate-fade-in">
                    
                    {/* Tab 1: Home */}
                    <div className={`flex flex-col flex-1 h-full overflow-hidden ${activeTab === 'home' ? 'block' : 'hidden'}`}>
                        <div className="relative bg-black w-full aspect-video flex-shrink-0 z-20 shadow-md flex items-center justify-center text-gray-500">
                            <div className="text-center"><Camera size={32} className="mx-auto mb-2 opacity-50"/><span className="text-xs">å®æ—¶ç›‘æ§ç”»é¢ (Demo)</span></div>
                            <div className="absolute top-3 left-3 flex gap-2"><div className="flex items-center gap-1.5 px-2 py-1 rounded-md backdrop-blur-md text-[10px] font-bold text-white shadow-sm bg-green-500"><div className="w-1.5 h-1.5 rounded-full bg-white animate-pulse"></div>ç›‘æ§ä¸­</div></div>
                        </div>
                        
                        <div className="flex-1 flex flex-col bg-gray-50 overflow-hidden relative">
                             <div className="flex-1 overflow-y-auto p-4 space-y-4" ref={chatContainerRef}>
                                <div className="grid grid-cols-2 gap-3 mb-2">
                                    {Object.keys(petData).map(cat => (
                                        <div key={cat} className="bg-white p-3 rounded-xl border border-gray-100 shadow-sm flex flex-col gap-2">
                                           <div className="flex items-center gap-2"><div className={`w-6 h-6 rounded-full flex items-center justify-center text-[10px] font-bold ${petData[cat].avatarColor.split(' ')[0]} ${petData[cat].avatarColor.split(' ')[1]}`}>{cat[0]}</div><span className="font-bold text-xs text-gray-800">{cat}</span></div>
                                           <div><div className="flex justify-between text-[10px] text-gray-400 mb-1"><span>æ´»è·ƒåº¦</span><span className="font-bold text-gray-600">{petData[cat].activeLevel}%</span></div><div className="w-full bg-gray-100 h-1 rounded-full overflow-hidden"><div className={`h-full rounded-full ${cat === mainPetName ? 'bg-orange-400' : 'bg-yellow-400'}`} style={{ width: `${petData[cat].activeLevel}%` }}></div></div></div>
                                        </div>
                                    ))}
                                </div>
                                {chatMessages.map(msg => (
                                  <div key={msg.id} className={`flex flex-col ${msg.type === 'user' ? 'items-end' : 'items-start'}`}>
                                     <div className={`flex max-w-[90%] ${msg.type === 'user' ? 'flex-row-reverse' : 'flex-row'} items-end gap-2`}>
                                        {msg.type !== 'user' && <div className="w-8 h-8 rounded-full bg-white border border-gray-100 flex items-center justify-center shadow-sm"><Bot size={18} className="text-indigo-600"/></div>}
                                        <div className={`px-4 py-3 text-sm shadow-sm ${msg.type === 'user' ? 'bg-indigo-600 text-white rounded-2xl rounded-br-sm' : 'bg-white text-gray-800 rounded-2xl rounded-bl-sm border border-gray-100'}`}>
                                            <div className="leading-relaxed whitespace-pre-wrap">{formatText(msg.text)}</div>
                                        </div>
                                     </div>
                                  </div>
                                ))}
                                {isAiThinking && <div className="flex justify-start items-center ml-10 animate-pulse"><div className="bg-white border border-gray-100 rounded-full px-4 py-2 flex items-center gap-2 shadow-sm"><Loader2 size={14} className="animate-spin text-indigo-500"/><span className="text-xs text-gray-500 font-medium">æ€è€ƒä¸­...</span></div></div>}
                             </div>
                             <div className="p-3 bg-white border-t border-gray-100 shadow-lg z-30">
                                <div className="flex gap-2 items-center"><input type="text" value={inputMessage} onChange={(e) => setInputMessage(e.target.value)} onKeyPress={(e) => e.key === 'Enter' && handleSendMessage()} placeholder="å’Œçˆ±å® ç®¡å®¶èŠèŠå§..." className="flex-1 bg-gray-100 rounded-full px-5 py-2.5 text-sm focus:outline-none" /><button onClick={() => handleSendMessage()} className="bg-orange-500 text-white p-2.5 rounded-full"><Send size={18} /></button></div>
                             </div>
                        </div>
                    </div>

                    {/* Tab 2: Timeline */}
                    {activeTab === 'timeline' && (
                        <div className="p-4 flex-1 overflow-y-auto bg-gray-50 pb-20">
                          <h2 className="text-xl font-bold text-gray-800 mb-4">æ¯æ—¥å–µè®°</h2>
                          <div className="space-y-4">
                              <div className="bg-white p-5 rounded-2xl border border-orange-100 shadow-sm relative overflow-hidden"><div className="absolute top-0 right-0 p-3 opacity-10"><Sparkles className="text-orange-500" size={50}/></div><div className="font-bold text-gray-800 mb-2">{mainPetName}</div><div className="text-sm text-gray-600 leading-relaxed whitespace-pre-line">{formatText(petData[mainPetName].report)}</div></div>
                          </div>
                          <h3 className="text-sm font-bold text-gray-400 my-4 uppercase tracking-wider">ä»Šæ—¥è®°å½•</h3>
                          <div className="space-y-4 pl-4 border-l-2 border-gray-200 ml-2">
                              {logs.map(log => (
                                <div key={log.id} className="relative pl-6">
                                  <div className="absolute -left-[21px] top-1 w-3 h-3 rounded-full bg-orange-400 border-2 border-white shadow"></div>
                                  <div className="bg-white rounded-xl p-3 shadow-sm border border-gray-100">
                                     <div className="flex justify-between mb-1"><span className="font-bold text-sm">{log.action}</span><span className="text-xs text-gray-400">{log.time}</span></div>
                                     <div className="text-xs text-gray-500">{log.detail}</div>
                                  </div>
                                </div>
                              ))}
                          </div>
                        </div>
                    )}

                    {/* Tab 3: Settings */}
                    {activeTab === 'settings' && (
                        <div className="flex-1 bg-gray-50 p-4">
                           <h2 className="text-2xl font-bold text-gray-900 mb-4">è®¾ç½®</h2>
                           <div className="bg-white rounded-xl p-4 shadow-sm border border-gray-100">
                               <div className="text-sm font-bold text-gray-500 mb-2">å·²ç»‘å®šçš„å® ç‰©</div>
                               {Object.keys(petData).map(name => (
                                   <div key={name} className="flex items-center gap-3 py-2 border-b border-gray-50 last:border-0">
                                       <div className="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center text-xs">{name[0]}</div>
                                       <div><div className="font-bold text-sm">{name}</div>
