<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PetGuard Dev Demo</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.344.0"
      }
    }
    </script>

    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .animate-fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes slideDown { from { transform: translateY(-100%); } to { transform: translateY(0); } }
        .animate-slide-down { animation: slideDown 0.5s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes zoomIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .animate-zoom-in { animation: zoomIn 0.2s ease-out; }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
            Activity, Bell, Settings, AlertTriangle, Clock, X, 
            Sparkles, Utensils, Moon, Footprints, 
            Wifi, Battery, ChevronRight, Edit2, Shield, Droplets, Calendar, 
            ChevronLeft, Play, PlayCircle, Video, Film, Zap, Save
        } from 'lucide-react';

        // ==========================================
        // ğŸ”§ é…ç½®åŒºåŸŸ
        // ==========================================

        const CONFIG = {
            currentDate: "11/24", 
            alertTriggerTime: 14000, 
        };

        // ğŸ± çŒ«å’ªæ¡£æ¡ˆ (åˆå§‹æ•°æ® - æ–°å¢ features å­—æ®µ)
        const INITIAL_PET_DATA = {
            'æ —å­': { 
                type: 'ç‹¸èŠ±çŒ«', weight: '4.2kg',
                features: 'çŸ­æ¯›ï¼Œå…¨èº«è¦†ç›–é»‘ç°ç›¸é—´çš„ç»å…¸æ–‘çº¹ï¼Œè…¹éƒ¨æ¯›è‰²è¾ƒæµ…ï¼Œå››è‚¢æœ‰ç¯çŠ¶çº¹è·¯ã€‚',
                avatarColor: 'bg-gray-200 text-gray-700',
                report: `**ã€æ —å­æ—¥æŠ¥ã€‘**\nä»Šæ—¥æ ‡ç­¾ï¼š**ç²¾åŠ›è¿‡å‰©**ã€‚\n06:30 è¿›è¡Œäº†é«˜å¼ºåº¦çš„**æ´»åŠ¨**ï¼ˆè·‘é…·ï¼‰ã€‚å…¨å¤©**é¥®é£Ÿé¥®æ°´**æ­£å¸¸ã€‚æ³¨æ„ï¼š23:09 æ£€æµ‹åˆ°**å¤šçŒ«äº’åŠ¨**ï¼ˆè¿½é€ï¼‰ã€‚`
            },
            'å¥¶æ²¹': { 
                type: 'é‡‘æ¸å±‚é•¿æ¯›', weight: '5.5kg',
                features: 'é•¿æ¯›ï¼ŒèƒŒéƒ¨å‘ˆç°é‡‘æ¸å±‚è‰²ï¼Œé¢éƒ¨åœ†æ¶¦ï¼Œè€³å°–æœ‰å°‘é‡èªæ˜æ¯›ï¼Œå°¾å·´è“¬æ¾ã€‚',
                avatarColor: 'bg-yellow-100 text-yellow-700',
                report: `**ã€å¥¶æ²¹æ—¥æŠ¥ã€‘**\nä»Šæ—¥æ ‡ç­¾ï¼š**å²æœˆé™å¥½**ã€‚\nå¤§éƒ¨åˆ†æ—¶é—´å¤„äº**ä¼‘æ¯**çŠ¶æ€ã€‚09:40 è¿›è¡Œäº†**é¥®é£Ÿé¥®æ°´**ã€‚æ™šé—´è¢«åŠ¨å‚ä¸äº†ä¸€æ¬¡**å¤šçŒ«äº’åŠ¨**ã€‚`
            }
        };

        // ğŸ¨ äº‹ä»¶æ ·å¼å®šä¹‰
        const getEventStyle = (action) => {
            if (action === 'å¤šçŒ«äº’åŠ¨' || action === 'å‘•å') {
                return {
                    bg: 'bg-orange-50', border: 'border-orange-100', 
                    text: 'text-orange-700', iconColor: 'text-orange-500',
                    iconBg: 'bg-orange-500', icon: <AlertTriangle size={14} className="text-white"/>
                };
            }
            return {
                bg: 'bg-white', border: 'border-blue-50', 
                text: 'text-gray-600', iconColor: 'text-blue-400',
                iconBg: 'bg-blue-50', icon: <Clock size={14} className="text-blue-400"/>
            };
        };
        
        // ğŸ¨ å°é¢å›¾æ ‡å®šä¹‰
        const getThumbIcon = (action) => {
             if (!action) return <Film size={24}/>;
             if (action.includes('é¥®é£Ÿ') || action.includes('é¥®æ°´')) return <Utensils size={24}/>;
             if (action.includes('ä¼‘æ¯')) return <Moon size={24}/>;
             if (action.includes('æ´»åŠ¨') || action.includes('è·‘é…·')) return <Zap size={24}/>;
             if (action.includes('äº’åŠ¨') || action.includes('å¤šçŒ«')) return <Activity size={24}/>;
             if (action.includes('å‘•å')) return <AlertTriangle size={24}/>;
             return <Film size={24}/>;
        }

        // ğŸ“… æ—¥å†æ•°æ®ç”Ÿæˆ
        const generateCalendarData = () => {
            const days = [];
            const today = new Date(2025, 10, 24); 
            const weekMap = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
            
            for (let i = 29; i >= 0; i--) {
                const d = new Date(today);
                d.setDate(d.getDate() - i);
                days.push({
                    fullDate: `${d.getMonth() + 1}/${d.getDate()}`,
                    day: String(d.getDate()),
                    week: weekMap[d.getDay()],
                    isToday: i === 0
                });
            }
            return days;
        };

        const CALENDAR_DAYS = generateCalendarData();

        // ğŸ“ æ—¥å¿—ç”Ÿæˆå™¨
        const getHistoryLogs = (date) => {
            if (date.includes('24')) { 
                return [
                    { 
                        id: '24-1', 
                        time: '14:30', 
                        cat: 'å¥¶æ²¹', 
                        act: ["æ´»åŠ¨", "å¤šçŒ«äº’åŠ¨"], 
                        desc: "å¥¶æ²¹åœ¨å®¢å…åœ°é¢æ‚ é—²åœ°å·¡è§†äº†ä¸€åœˆï¼Œéšåè½»å¿«åœ°è·³ä¸ŠçŒ«çˆ¬æ¶ï¼Œå¹¶æŠ¬å¤´çœ‹å‘é«˜å¤„çš„åŒä¼´ã€‚", 
                        stat: "çŠ¶æ€éå¸¸æ´»æ³¼ï¼Œæ¢ç´¢æ¬²æ»¡æ»¡ï¼Œæ˜¯ä¸ªå……æ»¡å¥½å¥‡å¿ƒçš„å°å¯çˆ±ã€‚",
                        videoTime: 10, 
                        thumbColor: 'bg-yellow-100 text-yellow-600'
                    },
                    { 
                        id: '24-2', 
                        time: '14:28', 
                        cat: 'æ —å­', 
                        act: ["ä¼‘æ¯", "å¤šçŒ«äº’åŠ¨"], 
                        desc: "æ —å­ä¸€ç›´ç¨³ç¨³åœ°è¶´åœ¨çŒ«çˆ¬æ¶çš„é«˜å±‚çªé‡Œï¼Œä¿¯ç°ç€ä¸‹æ–¹æ´»åŠ¨çš„åŒä¼´ï¼Œç¥æƒ…æ·¡å®šè‡ªè‹¥ã€‚", 
                        stat: "æƒ…ç»ªç¨³å®šä¸”æ”¾æ¾ï¼Œåƒæ˜¯åœ¨äº«å—å®ƒçš„åˆåé™è°§æ—¶å…‰ï¼ŒçŠ¶æ€å¾ˆå¥½ã€‚",
                        videoTime: 10,
                        thumbColor: 'bg-gray-200 text-gray-600'
                    },
                    { 
                        id: '24-3', 
                        time: '09:40', 
                        cat: 'å¥¶æ²¹', 
                        act: ["é¥®é£Ÿé¥®æ°´"], 
                        desc: "å¥¶æ²¹èµ°åˆ°é¥®æ°´æœºå‰ï¼ŒæŒç»­é¥®æ°´çº¦ 45 ç§’ã€‚é¥®æ°´é‡æ­£å¸¸ã€‚", 
                        stat: "æ°´åˆ†è¡¥å……å……è¶³ï¼Œè‚¾è„å¥åº·å®ˆæŠ¤ä¸­ã€‚",
                        videoTime: 10, 
                        thumbColor: 'bg-blue-50 text-blue-500'
                    },
                    { 
                        id: '24-4', 
                        time: '08:15', 
                        cat: 'åŒçŒ«', 
                        act: ["é¥®é£Ÿé¥®æ°´"], 
                        desc: "è‡ªåŠ¨å–‚é£Ÿå™¨å‡ºç²®ï¼Œæ —å­å’Œå¥¶æ²¹åŒæ—¶å¬åˆ°å£°éŸ³è·‘æ¥è¿›é£Ÿã€‚", 
                        stat: "é£Ÿæ¬²è‰¯å¥½ï¼Œè¿›é£Ÿç§¯æã€‚",
                        videoTime: 10,
                        thumbColor: 'bg-green-100 text-green-600'
                    }, 
                    { 
                        id: '24-5', 
                        time: '06:30', 
                        cat: 'æ —å­', 
                        act: ["æ´»åŠ¨"], 
                        desc: "æ£€æµ‹åˆ°é«˜é¢‘ç§»åŠ¨ï¼ˆè·‘é…·ï¼‰ï¼ŒæŒç»­æ—¶é—´çº¦ 5 åˆ†é’Ÿã€‚", 
                        stat: "AIåˆ¤å®šï¼šé«˜èƒ½è¿åŠ¨", 
                        videoTime: 10, 
                        thumbColor: 'bg-red-50 text-red-500'
                    }
                ];
            } 
            if (date.includes('23')) { 
                return [
                    { id: '23-1', time: '23:15', cat: 'å¥¶æ²¹', act: ["å‘•å"], desc: "æ£€æµ‹åˆ°è…¹éƒ¨æŠ½æï¼Œåå‡ºæ¯›çƒ", stat: "âš ï¸ å¼‚å¸¸æ£€æµ‹", videoTime: 0, thumbColor: 'bg-red-100 text-red-600', videoSrc: CONFIG.secondaryVideo },
                    { id: '23-2', time: '14:20', cat: 'åŒçŒ«', act: ["ä¼‘æ¯"], desc: "åˆåå°æ†©ï¼Œç¯å¢ƒå®‰é™", stat: "çŠ¶æ€ï¼šæ”¾æ¾", videoTime: 10, thumbColor: 'bg-blue-50 text-blue-500' },
                    { id: '23-3', time: '08:00', cat: 'æ —å­', act: ["é¥®é£Ÿé¥®æ°´"], desc: "æ­£å¸¸æ—©é¤", stat: "çŠ¶æ€ï¼šæ­£å¸¸", videoTime: 10, thumbColor: 'bg-green-50 text-green-600' }
                ];
            }
            return [
                { id: 'x-1', time: '18:00', cat: 'åŒçŒ«', act: ["é¥®é£Ÿé¥®æ°´"], desc: "æ™šé¤æ—¶é—´", stat: "AIåˆ¤å®šï¼šè¿›é£Ÿ", videoTime: 10, thumbColor: 'bg-green-50 text-green-600' },
                { id: 'x-2', time: '14:00', cat: 'å¥¶æ²¹', act: ["ä¼‘æ¯"], desc: "åœ¨çŒ«çˆ¬æ¶ç¡è§‰", stat: "AIåˆ¤å®šï¼šä¼‘æ¯", videoTime: 10, thumbColor: 'bg-yellow-50 text-yellow-600' },
                { id: 'x-3', time: '09:00', cat: 'æ —å­', act: ["æ´»åŠ¨"], desc: "æŠ“æ¿ç£¨çˆª", stat: "AIåˆ¤å®šï¼šæ´»åŠ¨", videoTime: 10, thumbColor: 'bg-gray-50 text-gray-500' }
            ];
        };

        const formatText = (text) => {
            if (!text) return null;
            return text.split(/(\*\*.*?\*\*)/g).map((part, i) => 
                part.startsWith('**') ? <strong key={i} className="font-bold text-indigo-700">{part.slice(2, -2)}</strong> : part
            );
        };

        // ğŸ¥ è§†é¢‘è§¦å‘å‰§æœ¬
        const VIDEO_SCRIPT = [
          { startTime: 0, endTime: 12, hasMotion: false },
          { 
            startTime: 12, endTime: 16, hasMotion: true, 
            triggerAlert: { 
              timeTrigger: 14, cat: 'åŒçŒ«', 
              act: ["å¤šçŒ«äº’åŠ¨"], 
              title: 'æ£€æµ‹åˆ°å¤šçŒ«äº’åŠ¨', 
              desc: 'ã€å®æ—¶ã€‘æ£€æµ‹åˆ°æ·±å¤œè·‘é…·è¿½é€ï¼ŒåŒæ–¹åœ¨å®¢å…å¿«é€Ÿç§»åŠ¨ã€‚', 
              stat: 'AI åˆ¤å®šï¼šé«˜èƒ½ç©è€',
              videoTime: 14 
            }
          },
          { startTime: 16, endTime: 100, hasMotion: false }
        ];

        function App() {
          const [activeTab, setActiveTab] = useState('timeline');
          const [videoUrl, setVideoUrl] = useState(CONFIG.defaultVideo);
          const [playModal, setPlayModal] = useState({ show: false, startTime: 0, src: null }); 
          const [selectedDate, setSelectedDate] = useState('24');
          const [currentLogs, setCurrentLogs] = useState([]);
          const [selectedCatFilter, setSelectedCatFilter] = useState('all'); 
          const [pushNotification, setPushNotification] = useState(null);
          const [hasTriggered, setHasTriggered] = useState(false);
          const [triggeredAlerts, setTriggeredAlerts] = useState(new Set());
          
          // å® ç‰©æ•°æ® State
          const [petData, setPetData] = useState(INITIAL_PET_DATA);
          const [editModalOpen, setEditModalOpen] = useState(false);
          const [editingPetKey, setEditingPetKey] = useState(null);
          // æ–°å¢ features å­—æ®µ
          const [editForm, setEditForm] = useState({ name: '', type: '', weight: '', features: '' });
          
          const videoRef = useRef(null);
          const modalVideoRef = useRef(null);
          const scrollContainerRef = useRef(null);
          
          useEffect(() => {
              setCurrentLogs(getHistoryLogs(selectedDate));
          }, [selectedDate]);

          // è‡ªåŠ¨æ»šåŠ¨æ—¥å†
          useEffect(() => {
            setTimeout(() => {
                if (scrollContainerRef.current) {
                    scrollContainerRef.current.scrollLeft = scrollContainerRef.current.scrollWidth;
                }
            }, 100);
          }, []);

          // åå°è§†é¢‘è‡ªåŠ¨æ’­æ”¾
          useEffect(() => {
            if (videoUrl === CONFIG.defaultVideo && videoRef.current) {
               setTimeout(() => videoRef.current?.play().catch(e => console.log("Autoplay blocked")), 800);
            }
          }, []);

          // æ ¸å¿ƒé€»è¾‘å¾ªç¯
          useEffect(() => {
            if (!videoRef.current) return;
            const videoElement = videoRef.current;
            const handleTimeUpdate = () => {
              const time = videoElement.currentTime;
              const activeScript = VIDEO_SCRIPT.find(s => time >= s.startTime && time < s.endTime);
              
              if (activeScript?.triggerAlert && Math.floor(time) === activeScript.triggerAlert.timeTrigger) {
                 const alertId = `alert-${Math.floor(time)}`;
                 if (!triggeredAlerts.has(alertId)) {
                     setTriggeredAlerts(prev => new Set(prev).add(alertId));
                     
                     setPushNotification({ 
                         title: activeScript.triggerAlert.title, 
                         text: activeScript.triggerAlert.desc, 
                         videoTime: activeScript.triggerAlert.videoTime 
                     });
                     setTimeout(() => setPushNotification(null), 6000);
                     
                     if (selectedDate === '24') { 
                         setCurrentLogs(prev => {
                            if(prev.find(l => l.time === '23:09')) return prev;
                            return [{
                                id: 'alert-24', 
                                time: '23:09', 
                                cat: 'åŒçŒ«', 
                                act: activeScript.triggerAlert.act, 
                                desc: activeScript.triggerAlert.desc, 
                                stat: activeScript.triggerAlert.stat,
                                videoTime: activeScript.triggerAlert.videoTime, 
                                thumbColor: 'bg-gray-800 text-white'
                            }, ...prev];
                         });
                     }
                 }
              }
            };
            videoElement.addEventListener('timeupdate', handleTimeUpdate);
            return () => videoElement.removeEventListener('timeupdate', handleTimeUpdate);
          }, [videoUrl, triggeredAlerts, selectedDate]);

          // å¼¹çª—è§†é¢‘åŒæ­¥
          useEffect(() => {
            if (playModal.show && modalVideoRef.current) {
              modalVideoRef.current.currentTime = playModal.startTime;
              modalVideoRef.current.play().catch(e => {});
            }
          }, [playModal.show]);

          const handleJumpToVideo = (time, src = null) => {
              const targetSrc = src || videoUrl;
              if (time === null || time === undefined) return;
              if (!targetSrc) return alert("è§†é¢‘æºæœªåŠ è½½");
              setPlayModal({ show: true, startTime: time, src: targetSrc });
              setPushNotification(null);
          };

          // --- ç¼–è¾‘å® ç‰©ç›¸å…³å‡½æ•° ---
          const openEditModal = (catKey) => {
              setEditingPetKey(catKey);
              setEditForm({
                  name: catKey,
                  type: petData[catKey].type,
                  weight: petData[catKey].weight,
                  features: petData[catKey].features || '' // å¡«å……ç°æœ‰ç‰¹å¾
              });
              setEditModalOpen(true);
          };

          const savePetInfo = () => {
              const newPetData = { ...petData };
              const oldName = editingPetKey;
              const newName = editForm.name;

              const updatedInfo = {
                  type: editForm.type,
                  weight: editForm.weight,
                  features: editForm.features // ä¿å­˜ç‰¹å¾
              };

              if (oldName !== newName) {
                  newPetData[newName] = {
                      ...newPetData[oldName],
                      ...updatedInfo
                  };
                  delete newPetData[oldName];
              } else {
                  newPetData[oldName] = {
                      ...newPetData[oldName],
                      ...updatedInfo
                  };
              }
              
              setPetData(newPetData);
              setEditModalOpen(false);
          };

          const TabButton = ({ id, icon: Icon, label }) => (
            <button onClick={() => setActiveTab(id)} className={`flex flex-col items-center justify-center w-full py-2 transition-colors ${activeTab === id ? 'text-orange-600' : 'text-gray-400'}`}>
              <Icon size={24} className={`mb-1 ${activeTab === id ? 'scale-110' : ''} transition-transform`} />
              <span className="text-[10px] font-medium">{label}</span>
            </button>
          );
          
          const getTagStyle = (tag) => {
              if (tag === 'å¤šçŒ«äº’åŠ¨' || tag === 'å‘•å' || tag.includes('å¼‚å¸¸')) {
                  return 'bg-orange-100 text-orange-700 border-orange-200';
              }
              if (tag === 'é¥®é£Ÿé¥®æ°´') return 'bg-blue-50 text-blue-600 border-blue-100';
              if (tag === 'ä¼‘æ¯') return 'bg-purple-50 text-purple-600 border-purple-100';
              return 'bg-gray-100 text-gray-600 border-gray-200';
          };

          return (
            <div className="bg-gray-50 min-h-screen font-sans text-gray-900 pb-20 relative max-w-md mx-auto shadow-2xl overflow-hidden border-x border-gray-200 flex flex-col">
              
              <div className="hidden">
                 <video ref={videoRef} src={videoUrl} loop muted playsInline />
              </div>

              {/* Push Notification */}
              {pushNotification && (
                <div onClick={() => handleJumpToVideo(pushNotification.videoTime)} className="fixed top-4 left-4 right-4 bg-white/95 backdrop-blur-md rounded-2xl shadow-xl z-[60] border-l-4 border-orange-500 p-4 animate-slide-down cursor-pointer flex items-start gap-3 ring-1 ring-black/5">
                   <div className="bg-orange-100 p-2 rounded-full text-orange-600 flex-shrink-0 mt-0.5"><AlertTriangle size={20} /></div>
                   <div className="flex-1 min-w-0">
                     <div className="flex justify-between items-start"><h4 className="font-bold text-gray-900 text-sm">PetGuard æ™ºèƒ½è­¦æŠ¥</h4><span className="text-[10px] text-gray-400">åˆšåˆš</span></div>
                     <p className="font-medium text-gray-800 text-xs mt-1 truncate">{pushNotification.title}</p>
                     <p className="text-gray-500 text-[10px] mt-0.5 line-clamp-2">{pushNotification.text}</p>
                   </div>
                </div>
              )}

              {/* Video Modal */}
              {playModal.show && (
                <div className="fixed inset-0 z-[70] bg-black/95 flex flex-col justify-center items-center animate-in fade-in duration-200">
                  <button onClick={() => setPlayModal({ show: false, startTime: 0, src: null })} className="absolute top-4 right-4 text-white p-2 bg-white/10 rounded-full hover:bg-white/20 transition-colors z-50"><X size={24} /></button>
                  <div className="w-full aspect-video bg-black relative">
                    {/* å›æ”¾æ— æ¡† */}
                    <video ref={modalVideoRef} src={playModal.src} className="w-full h-full object-contain" controls muted autoPlay />
                  </div>
                  <div className="mt-6 text-white/90 text-sm bg-gray-800/80 px-6 py-2 rounded-full border border-white/10 flex items-center gap-2"><Sparkles size={14} className="text-yellow-400"/> AI æ™ºèƒ½å›æ”¾</div>
                </div>
              )}

              {/* ç¼–è¾‘å® ç‰©å¼¹çª— */}
              {editModalOpen && (
                <div className="fixed inset-0 z-[80] bg-black/60 backdrop-blur-sm flex items-center justify-center animate-fade-in">
                    <div className="bg-white w-[85%] max-w-sm rounded-2xl p-6 shadow-2xl animate-zoom-in">
                        <div className="flex justify-between items-center mb-4">
                            <h3 className="text-lg font-bold text-gray-900">ç¼–è¾‘ä¿¡æ¯</h3>
                            <button onClick={() => setEditModalOpen(false)} className="text-gray-400 hover:text-gray-600"><X size={20}/></button>
                        </div>
                        <div className="space-y-4">
                            <div>
                                <label className="block text-xs font-medium text-gray-500 mb-1">åå­—</label>
                                <input 
                                    type="text" 
                                    value={editForm.name} 
                                    onChange={(e) => setEditForm({...editForm, name: e.target.value})}
                                    className="w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-orange-500/50 transition-all"
                                />
                            </div>
                            <div>
                                <label className="block text-xs font-medium text-gray-500 mb-1">å“ç§</label>
                                <input 
                                    type="text" 
                                    value={editForm.type} 
                                    onChange={(e) => setEditForm({...editForm, type: e.target.value})}
                                    className="w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-orange-500/50 transition-all"
                                />
                            </div>
                            <div>
                                <label className="block text-xs font-medium text-gray-500 mb-1">ä½“é‡</label>
                                <input 
                                    type="text" 
                                    value={editForm.weight} 
                                    onChange={(e) => setEditForm({...editForm, weight: e.target.value})}
                                    className="w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-orange-500/50 transition-all"
                                />
                            </div>
                            {/* æ–°å¢ï¼šå¤–è¡¨ç‰¹å¾å¤šè¡Œæ–‡æœ¬åŸŸ */}
                            <div>
                                <label className="block text-xs font-medium text-gray-500 mb-1">å¤–è¡¨ç‰¹å¾</label>
                                <textarea
                                    value={editForm.features}
                                    onChange={(e) => setEditForm({...editForm, features: e.target.value})}
                                    className="w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-orange-500/50 transition-all resize-none h-20"
                                    placeholder="ä¾‹å¦‚ï¼šæ¯›è‰²ã€é•¿çŸ­æ¯›ã€èŠ±è‰²åˆ†å¸ƒ..."
                                />
                            </div>
                        </div>
                        <div className="mt-6 flex gap-3">
                            <button onClick={() => setEditModalOpen(false)} className="flex-1 py-2 text-sm text-gray-600 font-medium bg-gray-100 rounded-full hover:bg-gray-200 transition-colors">å–æ¶ˆ</button>
                            <button onClick={savePetInfo} className="flex-1 py-2 text-sm text-white font-bold bg-orange-500 rounded-full hover:bg-orange-600 transition-colors shadow-md active:scale-95 flex items-center justify-center gap-1">
                                <Save size={14}/> ä¿å­˜
                            </button>
                        </div>
                    </div>
                </div>
              )}

              {/* ======= Tab 1: æ—¥æŠ¥ (Timeline) ======= */}
              {activeTab === 'timeline' && (
                <div className="flex-1 bg-gray-50 overflow-y-auto flex flex-col">
                   {/* Calendar Header */}
                   <div className="bg-white px-4 pt-4 pb-3 border-b border-gray-100 sticky top-0 z-20 shadow-sm">
                      <div className="flex justify-between items-center mb-3">
                          <h2 className="text-xl font-bold text-gray-900">PetGuard æ—¥å¿—</h2>
                          <div className="flex bg-gray-100 rounded-lg p-0.5">
                             {['all', 'æ —å­', 'å¥¶æ²¹'].map(filter => (
                               <button key={filter} onClick={() => setSelectedCatFilter(filter)} className={`px-3 py-1 text-xs rounded-md transition-all ${selectedCatFilter === filter ? 'bg-white text-orange-600 shadow-sm font-medium' : 'text-gray-500'}`}>{filter === 'all' ? 'å…¨éƒ¨' : filter}</button>
                             ))}
                          </div>
                      </div>
                      <div className="flex gap-2 overflow-x-auto pb-2 custom-scrollbar" ref={scrollContainerRef}>
                          {CALENDAR_DAYS.map(d => (
                              <button 
                                key={d.fullDate} 
                                onClick={() => setSelectedDate(d.day)} 
                                className={`flex-shrink-0 w-10 h-12 rounded-xl flex flex-col items-center justify-center border transition-all ${selectedDate === d.day ? 'bg-orange-500 border-orange-500 text-white shadow-md' : 'bg-white border-gray-100 text-gray-400'}`}
                              >
                                  <span className="text-[9px] opacity-80">{d.week}</span>
                                  <span className="text-xs font-bold">{d.day}</span>
                              </button>
                          ))}
                      </div>
                   </div>

                   <div className="p-4 space-y-6">
                      {/* Daily Report Card */}
                      <div className="space-y-3">
                         {(selectedCatFilter === 'all' || selectedCatFilter === 'æ —å­') && petData['æ —å­'] && (
                             <div className="bg-white p-4 rounded-xl border border-orange-100 shadow-sm relative overflow-hidden animate-fade-in">
                                <div className="flex items-center gap-2 mb-2">
                                    <div className="w-5 h-5 rounded-full bg-gray-200 flex items-center justify-center text-[10px] font-bold text-gray-600">æ —</div>
                                    <span className="font-bold text-sm text-gray-800">æ —å­</span>
                                </div>
                                <div className="text-xs text-gray-600 leading-relaxed whitespace-pre-line">{formatText(petData['æ —å­'].report)}</div>
                             </div>
                         )}
                         {(selectedCatFilter === 'all' || selectedCatFilter === 'å¥¶æ²¹') && petData['å¥¶æ²¹'] && (
                             <div className="bg-white p-4 rounded-xl border border-yellow-100 shadow-sm relative overflow-hidden animate-fade-in">
                                <div className="flex items-center gap-2 mb-2">
                                    <div className="w-5 h-5 rounded-full bg-yellow-100 flex items-center justify-center text-[10px] font-bold text-yellow-700">å¥¶</div>
                                    <span className="font-bold text-sm text-gray-800">å¥¶æ²¹</span>
                                </div>
                                <div className="text-xs text-gray-600 leading-relaxed whitespace-pre-line">{formatText(petData['å¥¶æ²¹'].report)}</div>
                             </div>
                         )}
                      </div>

                      {/* Timeline List */}
                      <div>
                          <h3 className="text-xs font-bold text-gray-400 mb-4 uppercase tracking-wider flex items-center justify-between">
                              <span>äº‹ä»¶æ—¶é—´è½´</span>
                              <span className="font-normal">{currentLogs.length} æ¡è®°å½•</span>
                          </h3>
                          <div className="space-y-6 relative before:absolute before:left-[15px] before:top-2 before:bottom-0 before:w-0.5 before:bg-gray-200">
                             {currentLogs
                               .filter(log => selectedCatFilter === 'all' || log.cat.includes(selectedCatFilter) || (log.cat === 'åŒçŒ«' && selectedCatFilter !== 'all'))
                               .map(log => {
                                 const style = getEventStyle(log.act[0]);
                                 const isImportant = log.act.includes('å‘•å') || log.act.includes('å¤šçŒ«äº’åŠ¨');

                                 return (
                                   <div key={log.id} className="relative pl-8 group animate-fade-in">
                                      <div className={`absolute left-0 top-3 w-8 h-8 rounded-full border-4 border-white shadow-sm flex items-center justify-center z-10 ${style.iconBg}`}>
                                         {style.icon}
                                      </div>
                                      
                                      <div className="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden">
                                         {/* Video Thumbnail Area */}
                                         <div onClick={() => handleJumpToVideo(log.videoTime, log.videoSrc)} className={`w-full h-32 relative cursor-pointer group/vid ${log.thumbColor}`}>
                                             <div className="absolute inset-0 bg-black/5 group-hover/vid:bg-black/10 transition-colors"></div>
                                             {/* Thumbnail Icon */}
                                             <div className="absolute inset-0 flex items-center justify-center opacity-30 group-hover/vid:opacity-40 transition-opacity">
                                                 {getThumbIcon(log.act[0])}
                                             </div>
                                             
                                             <div className="absolute inset-0 flex items-center justify-center">
                                                 <div className="w-10 h-10 bg-white/30 backdrop-blur-md rounded-full flex items-center justify-center shadow-lg transition-transform group-hover/vid:scale-110">
                                                     <Play size={18} className="text-white fill-current ml-0.5" />
                                                 </div>
                                             </div>
                                             <div className="absolute bottom-2 right-2 flex items-center gap-1 text-[10px] text-white font-medium bg-black/40 px-2 py-1 rounded backdrop-blur-sm">
                                                 <Video size={10} /> ç‚¹å‡»å›æ”¾
                                             </div>
                                         </div>

                                         <div className="p-3">
                                             <div className="flex justify-between items-start mb-2">
                                                 <div className="flex flex-col">
                                                     <div className="flex items-center gap-2 mb-1">
                                                         <span className="font-bold text-sm text-gray-800">{log.cat}</span>
                                                         <span className="text-xs text-gray-400">{log.time}</span>
                                                     </div>
                                                     <div className="flex gap-1 flex-wrap">
                                                         {log.act.map((tag, i) => {
                                                             const isAlert = tag.includes('äº’åŠ¨') || tag.includes('å‘•å');
                                                             return <span key={i} className={`text-[10px] px-1.5 py-0.5 rounded border ${getTagStyle(tag)}`}>{tag}</span>
                                                         })}
                                                     </div>
                                                 </div>
                                             </div>
                                             
                                             <p className="text-xs text-gray-700 leading-relaxed mb-3">{log.desc}</p>
                                             
                                             <div className="bg-gray-50 rounded-lg p-2 flex items-start gap-2">
                                                 <div className="mt-0.5"><Sparkles size={12} className="text-indigo-400"/></div>
                                                 <p className="text-[10px] text-gray-500 leading-snug">
                                                     {log.stat}
                                                 </p>
                                             </div>
                                         </div>
                                      </div>
                                   </div>
                                 );
                             })}
                          </div>
                      </div>
                   </div>
                </div>
              )}

              {/* ======= Tab 2: è®¾ç½® (Settings) ======= */}
              {activeTab === 'settings' && (
                <div className="flex-1 bg-gray-50 overflow-y-auto">
                    <div className="bg-white px-6 py-8 border-b border-gray-100"><h2 className="text-2xl font-bold text-gray-900 mb-1">è®¾ç½®</h2><p className="text-sm text-gray-500">ç®¡ç†æ‚¨çš„è®¾å¤‡ä¸å® ç‰©æ¡£æ¡ˆ</p></div>
                    <div className="p-4 space-y-6">
                        <section>
                            <div className="flex justify-between items-center mb-3 px-1"><h3 className="text-sm font-bold text-gray-700 uppercase tracking-wide">æˆ‘çš„å® ç‰©</h3></div>
                            <div className="space-y-3">
                                {Object.keys(petData).map(cat => (
                                    <div key={cat} className="bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex items-center justify-between group cursor-pointer hover:border-orange-200 transition-colors">
                                        <div className="flex items-center gap-4">
                                            <div className={`w-12 h-12 rounded-full ${petData[cat].avatarColor} flex items-center justify-center text-lg font-bold shadow-inner`}>{cat[0]}</div>
                                            <div>
                                                <div className="font-bold text-gray-900">{cat}</div>
                                                <div className="text-xs text-gray-500 mt-0.5">
                                                    {petData[cat].type} Â· {petData[cat].weight}
                                                    {/* å±•ç¤ºç‰¹å¾æ‘˜è¦ï¼ˆå¦‚æœæœ‰ï¼‰ */}
                                                    {petData[cat].features && <div className="mt-1 text-[10px] text-gray-400 line-clamp-1">{petData[cat].features}</div>}
                                                </div>
                                            </div>
                                        </div>
                                        <div onClick={() => openEditModal(cat)} className="bg-gray-50 p-2 rounded-full text-gray-400 group-hover:bg-orange-50 group-hover:text-orange-500 transition-colors">
                                            <Edit2 size={16}/>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </section>
                        <section>
                            <h3 className="text-sm font-bold text-gray-700 uppercase tracking-wide mb-3 px-1">é€šç”¨è®¾ç½®</h3>
                            <div className="bg-white rounded-xl shadow-sm border border-gray-100 divide-y divide-gray-50">
                                <div className="p-4 flex items-center justify-between"><div className="flex items-center gap-3"><div className="bg-blue-50 p-2 rounded-lg text-blue-600"><Wifi size={18}/></div><span className="text-sm font-medium text-gray-700">è®¾å¤‡è¿æ¥</span></div><div className="text-xs text-green-500 font-medium">åœ¨çº¿</div></div>
                                <div className="p-4 flex items-center justify-between"><div className="flex items-center gap-3"><div className="bg-orange-50 p-2 rounded-lg text-orange-600"><Bell size={18}/></div><span className="text-sm font-medium text-gray-700">æ™ºèƒ½é€šçŸ¥</span></div><div className="w-8 h-5 bg-orange-500 rounded-full relative"><div className="absolute top-1 right-1 w-3 h-3 bg-white rounded-full"></div></div></div>
                            </div>
                        </section>
                        <div className="text-center text-xs text-gray-400 py-4">PetGuard Dev Reference v1.0</div>
                    </div>
                </div>
              )}

              {/* Bottom Nav */}
              <div className="fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur-xl border-t border-gray-200 flex justify-around items-center px-6 pb-safe pt-1 max-w-md mx-auto z-40 h-[65px] shadow-[0_-1px_10px_rgba(0,0,0,0.02)]">
                  <TabButton id="timeline" icon={Activity} label="æ—¥æŠ¥" />
                  <TabButton id="settings" icon={Settings} label="è®¾ç½®" />
              </div>
            </div>
          );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
