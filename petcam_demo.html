<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PetGuard å®Œæ•´æ¼”ç¤º</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18.2.0",
        "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
        "lucide-react": "https://esm.sh/lucide-react@0.344.0"
      }
    }
    </script>

    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* éšè—æ»šåŠ¨æ¡ */
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        
        /* åŠ¨ç”»å®šä¹‰ */
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .animate-fade-in { animation: fadeIn 0.5s ease-out; }
        
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .animate-slide-up { animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1); }

        @keyframes pulse-ring { 0% { transform: scale(0.8); opacity: 0.5; } 100% { transform: scale(1.5); opacity: 0; } }
        .animate-pulse-ring { animation: pulse-ring 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        
        /* é’ˆå¯¹ iOS å®‰å…¨åŒºåŸŸçš„ä¼˜åŒ– */
        .pb-safe { padding-bottom: env(safe-area-inset-bottom); }
    </style>
</head>
<body class="bg-gray-100">
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useRef } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
            Camera, Activity, Bell, Settings, Play, Pause, AlertTriangle, Clock, X, 
            Sparkles, Utensils, Moon, Footprints, Upload, Volume2, VolumeX, Eye, 
            Radio, MessageCircle, Send, User, Bot, Filter, ZoomIn, PlayCircle, Film, 
            Loader2, Wifi, Battery, ChevronRight, Edit2, Shield, Droplets, Calendar, 
            BarChart2, ChevronLeft, Minimize2, ShoppingBag, HeartPulse, Lightbulb, CheckCircle,
            Mail, Lock, Cat, Scale, Ruler, Mic, ShieldCheck, Check
        } from 'lucide-react';

        // ==========================================
        // ğŸŸ¢ ç¬¬ä¸€éƒ¨åˆ†ï¼šOnboarding (åˆå§‹å¼•å¯¼æµç¨‹)
        // ==========================================
        
        const Onboarding = ({ onComplete }) => {
            const [step, setStep] = useState(0); 
            const [connectStatus, setConnectStatus] = useState('idle');
            
            // è¡¨å•æ•°æ®
            const [formData, setFormData] = useState({
                petName: '',
                petBreed: '',
                petWeight: '',
            });

            const nextStep = () => setStep(s => s + 1);

            // æ¨¡æ‹Ÿé…ç½‘é€»è¾‘
            const handleConnect = () => {
                setConnectStatus('scanning');
                setTimeout(() => setConnectStatus('connecting'), 1500); 
                setTimeout(() => setConnectStatus('success'), 3500);    
            };

            // æ­¥éª¤ 0: å¼€å±é¡µ
            if (step === 0) return (
                <div className="h-screen bg-orange-500 flex flex-col items-center justify-center text-white relative overflow-hidden cursor-pointer" onClick={nextStep}>
                    <div className="bg-white p-4 rounded-3xl mb-6 shadow-2xl animate-fade-in">
                        <Cat size={64} className="text-orange-500" />
                    </div>
                    <h1 className="text-4xl font-extrabold tracking-tight mb-2 animate-fade-in">PetGuard</h1>
                    <p className="opacity-90 animate-fade-in">AI é©±åŠ¨çš„æ™ºèƒ½å…»å® ä¸“å®¶</p>
                    <div className="absolute bottom-10 text-sm opacity-60 animate-pulse">ç‚¹å‡»å±å¹•å¼€å§‹ä½“éªŒ</div>
                </div>
            );

            // æ­¥éª¤ 1: ç™»å½•
            if (step === 1) return (
                <div className="h-screen bg-gray-50 max-w-md mx-auto flex flex-col p-6 pt-20 animate-fade-in">
                    <h1 className="text-3xl font-bold text-gray-900 mb-2">æ¬¢è¿å›æ¥ ğŸ‘‹</h1>
                    <p className="text-gray-500 mb-8">ç™»å½•ä»¥è¿æ¥æ‚¨çš„ PetGuard è®¾å¤‡</p>
                    <div className="space-y-4">
                        <div className="relative"><Mail className="absolute left-4 top-3.5 text-gray-400" size={20} /><input type="email" placeholder="é‚®ç®±åœ°å€" className="w-full pl-12 pr-4 py-3 bg-white border border-gray-200 rounded-xl focus:outline-none focus:border-orange-500 transition-all" /></div>
                        <div className="relative"><Lock className="absolute left-4 top-3.5 text-gray-400" size={20} /><input type="password" placeholder="å¯†ç " className="w-full pl-12 pr-4 py-3 bg-white border border-gray-200 rounded-xl focus:outline-none focus:border-orange-500 transition-all" /></div>
                    </div>
                    <div className="mt-auto mb-6">
                        <button onClick={nextStep} className="w-full bg-orange-500 text-white font-bold py-4 rounded-full shadow-lg hover:bg-orange-600 active:scale-95 transition-all">ç™»å½• / æ³¨å†Œ</button>
                    </div>
                </div>
            );

            // æ­¥éª¤ 2: é…ç½‘
            if (step === 2) return (
                <div className="h-screen bg-gray-50 max-w-md mx-auto flex flex-col p-6 pt-10 animate-fade-in">
                    <div className="flex justify-between items-center mb-6"><h2 className="text-2xl font-bold">æ·»åŠ è®¾å¤‡</h2><span className="text-xs font-mono text-orange-500 bg-orange-50 px-2 py-1 rounded">Step 1/3</span></div>
                    <div className="flex-1 flex flex-col items-center justify-center relative">
                        <div className={`w-64 h-64 rounded-full border-2 flex items-center justify-center relative transition-all duration-500 ${connectStatus === 'success' ? 'border-green-500 bg-green-50' : 'border-orange-100'}`}>
                            {connectStatus === 'scanning' && <div className="absolute inset-0 rounded-full border-4 border-orange-200 animate-pulse-ring"></div>}
                            {connectStatus === 'idle' && <Camera size={64} className="text-gray-300" />}
                            {(connectStatus === 'scanning' || connectStatus === 'connecting') && <Wifi size={64} className="text-orange-500 animate-pulse" />}
                            {connectStatus === 'success' && <Check size={64} className="text-green-500 animate-in zoom-in" />}
                        </div>
                        <div className="mt-8 text-center space-y-2">
                            <h3 className="text-xl font-bold text-gray-800">{connectStatus === 'idle' ? 'å¼€å¯è®¾å¤‡è“ç‰™' : connectStatus === 'success' ? 'è¿æ¥æˆåŠŸï¼' : 'æ­£åœ¨æœç´¢...'}</h3>
                        </div>
                    </div>
                    <div className="mt-auto mb-6">
                        {connectStatus === 'idle' ? <button onClick={handleConnect} className="w-full bg-gray-900 text-white font-bold py-4 rounded-full shadow-lg hover:bg-gray-800 transition-all">æœç´¢è®¾å¤‡</button> :
                         connectStatus === 'success' ? <button onClick={nextStep} className="w-full bg-green-500 text-white font-bold py-4 rounded-full shadow-lg hover:bg-green-600 transition-all flex items-center justify-center gap-2">ä¸‹ä¸€æ­¥ <ChevronRight size={20}/></button> :
                         <button disabled className="w-full bg-gray-100 text-gray-400 font-bold py-4 rounded-full cursor-not-allowed flex items-center justify-center gap-2"><Loader2 className="animate-spin" size={20}/> è¿æ¥ä¸­...</button>}
                    </div>
                </div>
            );

            // æ­¥éª¤ 3: å® ç‰©æ¡£æ¡ˆ (æ•°æ®æºå¤´)
            if (step === 3) return (
                <div className="h-screen bg-gray-50 max-w-md mx-auto flex flex-col p-6 pt-10 animate-fade-in">
                    <div className="flex justify-between items-center mb-6"><h2 className="text-2xl font-bold">è°æ˜¯å°ä¸»è§’ï¼Ÿ</h2><span className="text-xs font-mono text-orange-500 bg-orange-50 px-2 py-1 rounded">Step 2/3</span></div>
                    <div className="space-y-6">
                        <div className="flex justify-center"><div className="w-24 h-24 bg-gray-100 rounded-full flex items-center justify-center border-2 border-dashed border-gray-300 text-gray-400"><Camera size={24}/></div></div>
                        <div className="space-y-4">
                            <div><label className="text-xs font-bold text-gray-700 ml-1 mb-1 block">åå­—</label><div className="relative"><Cat className="absolute left-4 top-3.5 text-gray-400" size={18} /><input type="text" placeholder="ä¾‹å¦‚ï¼šæ —å­" value={formData.petName} onChange={e => setFormData({...formData, petName: e.target.value})} className="w-full pl-12 pr-4 py-3 bg-white border border-gray-200 rounded-xl focus:outline-none focus:border-orange-500 transition-all" /></div></div>
                            <div className="grid grid-cols-2 gap-4">
                                <div><label className="text-xs font-bold text-gray-700 ml-1 mb-1 block">å“ç§</label><div className="relative"><div className="absolute left-4 top-3.5 text-gray-400"><Ruler size={18}/></div><input type="text" placeholder="å¦‚ï¼šç¾çŸ­" value={formData.petBreed} onChange={e => setFormData({...formData, petBreed: e.target.value})} className="w-full pl-12 pr-4 py-3 bg-white border border-gray-200 rounded-xl focus:outline-none focus:border-orange-500 transition-all" /></div></div>
                                <div><label className="text-xs font-bold text-gray-700 ml-1 mb-1 block">ä½“é‡ (kg)</label><div className="relative"><div className="absolute left-4 top-3.5 text-gray-400"><Scale size={18}/></div><input type="number" placeholder="0.0" value={formData.petWeight} onChange={e => setFormData({...formData, petWeight: e.target.value})} className="w-full pl-12 pr-4 py-3 bg-white border border-gray-200 rounded-xl focus:outline-none focus:border-orange-500 transition-all" /></div></div>
                            </div>
                        </div>
                    </div>
                    <div className="mt-auto mb-6">
                        <button onClick={nextStep} disabled={!formData.petName} className={`w-full font-bold py-4 rounded-full shadow-lg transition-all flex items-center justify-center gap-2 ${formData.petName ? 'bg-orange-500 text-white hover:bg-orange-600' : 'bg-gray-200 text-gray-400 cursor-not-allowed'}`}>ä¸‹ä¸€æ­¥ <ChevronRight size={20}/></button>
                    </div>
                </div>
            );

            // æ­¥éª¤ 4: æƒé™
            if (step === 4) return (
                <div className="h-screen bg-gray-50 max-w-md mx-auto flex flex-col p-6 pt-10 animate-fade-in">
                    <div className="flex justify-between items-center mb-6"><h2 className="text-2xl font-bold">æœ€åä¸€æ­¥</h2><span className="text-xs font-mono text-orange-500 bg-orange-50 px-2 py-1 rounded">Step 3/3</span></div>
                    <div className="space-y-4">
                        <div className="bg-white p-4 rounded-2xl border border-orange-200 shadow-sm flex items-center gap-4 relative overflow-hidden">
                            <div className="absolute left-0 top-0 bottom-0 w-1 bg-orange-500"></div><div className="bg-orange-100 p-3 rounded-full text-orange-600"><Bell size={24}/></div>
                            <div className="flex-1"><h4 className="font-bold text-gray-900">å¼‚å¸¸é€šçŸ¥</h4><p className="text-xs text-gray-500 mt-1">æ¥æ”¶å‘•åã€æ‰“æ¶è­¦æŠ¥ã€‚</p></div>
                            <div className="relative inline-flex h-6 w-11 items-center rounded-full bg-orange-500"><span className="translate-x-6 inline-block h-4 w-4 transform rounded-full bg-white transition"/></div>
                        </div>
                    </div>
                    <div className="mt-auto mb-6">
                        <button onClick={() => onComplete(formData)} className="w-full bg-gray-900 text-white font-bold py-4 rounded-full shadow-lg hover:bg-gray-800 transition-all flex items-center justify-center gap-2">å¼€å¯å®ˆæŠ¤ä¹‹æ—… <Check size={20}/></button>
                    </div>
                </div>
            );
        };

        // ==========================================
        // ğŸ”µ ç¬¬äºŒéƒ¨åˆ†ï¼šDashboard (ä¸»åº”ç”¨é€»è¾‘)
        // ==========================================
        
        const CONFIG = {
            apiKey: "", 
            defaultVideo: "./pet_demo.mp4", 
            secondaryVideo: "./pet_demo2.mp4",
            currentDate: "11/24", 
            alertTriggerTime: 14, 
        };

        // è¾…åŠ©å‡½æ•°
        const generateCalendarDays = () => {
            const days = [];
            for (let i = 0; i < 6; i++) days.push(null);
            for (let i = 1; i <= 30; i++) days.push(i);
            return days;
        };

        const formatText = (text) => {
            if (!text) return null;
            const parts = text.split(/(\*\*.*?\*\*)/g);
            return parts.map((part, index) => {
                if (part.startsWith('**') && part.endsWith('**')) return <strong key={index} className="font-bold text-indigo-700">{part.slice(2, -2)}</strong>;
                return part;
            });
        };

        const Dashboard = ({ userData }) => {
            // --- åŠ¨æ€ç”Ÿæˆæ•°æ® ---
            // å°†ç”¨æˆ·è¾“å…¥çš„å® ç‰©æ›¿æ¢åŸæ¥çš„"æ —å­"
            const mainPetName = userData.petName || "æ —å­";
            const mainPetWeight = (userData.petWeight || "4.2") + "kg";
            
            // æ„å»ºå® ç‰©æ•°æ®
            const [petData, setPetData] = useState({
                [mainPetName]: { 
                    type: userData.petBreed || 'ç‹¸èŠ±çŒ«', weight: mainPetWeight,
                    activeLevel: 92, eatCount: 2, drinkCount: 2, 
                    avatarColor: 'bg-gray-200 text-gray-700',
                    preferences: ['çŒ«è–„è·çƒ', 'æ¿€å…‰ç¬”'],
                    recentStatus: 'ç²¾åŠ›è¿‡å‰©',
                    report: `**ã€${mainPetName}æ—¥æŠ¥ã€‘**\nä»Šæ—¥æ ‡ç­¾ï¼š**ç²¾åŠ›è¿‡å‰©**ã€‚\n6ç‚¹åŠå°±å¼€å§‹**è·‘é…·**ï¼Œ10ç‚¹åˆç©äº†çŒ«è–„è·çƒã€‚08:15 åƒäº†æ—©é¤ã€‚æˆªæ­¢ç›®å‰æ´»è·ƒåº¦å…¨å®¶ç¬¬ä¸€ã€‚æ³¨æ„ï¼š23:09 æ£€æµ‹åˆ°**å¤œé—´è·‘é…·**ã€‚`,
                    insight: `å»ºè®®ç¡å‰å¢åŠ  15 åˆ†é’Ÿé€—çŒ«æ£’äº’åŠ¨ï¼Œæ¶ˆè€—å…¶å¤šä½™ç²¾åŠ›ï¼Œå‡å°‘å¤œé—´è·‘é…·é¢‘ç‡ã€‚`
                },
                'å¥¶æ²¹': { 
                    type: 'é‡‘æ¸å±‚é•¿æ¯›', weight: '5.5kg',
                    activeLevel: 28, eatCount: 1, drinkCount: 1, 
                    avatarColor: 'bg-yellow-100 text-yellow-700',
                    preferences: ['å¼¹ç°§ç©å…·', 'çº¸ç®±'],
                    recentStatus: 'è¿åŠ¨ä¸è¶³',
                    report: `**ã€å¥¶æ²¹æ—¥æŠ¥ã€‘**\nä»Šæ—¥æ ‡ç­¾ï¼š**å²æœˆé™å¥½**ã€‚\né™¤äº†æ—©ä¸Šåƒé¥­å’Œ **09:40 å–æ°´**ï¼Œå‡ ä¹éƒ½åœ¨ç¡è§‰æˆ–æš—ä¸­è§‚å¯Ÿã€‚10:45 è¢«${mainPetName}å¸¦ç€è·‘äº†ä¸¤æ­¥ï¼Œæ€»ä½“éå¸¸è®©äººçœå¿ƒã€‚`,
                    insight: `å¥¶æ²¹æœ¬å‘¨å¹³å‡æ´»è·ƒåº¦ä»… 30%ï¼Œä¸”ç”»é¢ä¸­æœªæ£€æµ‹åˆ°å®ƒæœ€çˆ±çš„**å¼¹ç°§ç©å…·**ã€‚å¯èƒ½æ—§ç©å…·å·²ä¸¢å¤±ã€‚å»ºè®®è¡¥å……æ–°ç©å…·ä»¥æ¿€å‘è¿åŠ¨å…´è¶£ï¼Œé¢„é˜²è‚¥èƒ–ã€‚`
                }
            });

            // æ„å»ºæ—¥å¿—æ•°æ® (ä½¿ç”¨åŠ¨æ€åå­—)
            const [logs, setLogs] = useState([
                { id: 10, time: '10:45', cat: 'åŒçŒ«', type: 'normal', action: 'è¿½é€æ‰“é—¹', detail: 'å®¢å…å‘ç”ŸçŸ­æ—¶è¿½é€ï¼Œæ´»è·ƒåº¦ä¸Šå‡ï¼Œæœªæ£€æµ‹åˆ°æ”»å‡»è¡Œä¸º', videoTime: null, thumbColor: 'bg-indigo-100' },
                { id: 9, time: '10:20', cat: mainPetName, type: 'normal', action: 'ç©è€', detail: 'ç‹¬è‡ªç©çŒ«è–„è·çƒï¼ŒæŒç»­ 5 åˆ†é’Ÿ', videoTime: null, thumbColor: 'bg-orange-100' },
                { id: 8, time: '09:40', cat: 'å¥¶æ²¹', type: 'normal', action: 'é¥®æ°´', detail: 'é¥®æ°´é‡çº¦ 45mlï¼Œé¥®æ°´æœºå·¥ä½œæ­£å¸¸', videoTime: null, thumbColor: 'bg-blue-50' },
                { id: 7, time: '08:15', cat: 'åŒçŒ«', type: 'normal', action: 'è¿›é£Ÿ', detail: 'è‡ªåŠ¨å–‚é£Ÿå™¨å‡ºç²®ï¼ŒåŒçŒ«åŒæ—¶è¿›é£Ÿæ—©é¤', videoTime: null, thumbColor: 'bg-green-100' }, 
                { id: 6, time: '06:30', cat: mainPetName, type: 'normal', action: 'è·‘é…·', detail: 'æ£€æµ‹åˆ°é«˜é¢‘ç§»åŠ¨ï¼Œç–‘ä¼¼æ—©é—´å”¤é†’æœåŠ¡', videoTime: null, thumbColor: 'bg-red-50' },
            ]);

            const [chatMessages, setChatMessages] = useState([
                { id: 1, type: 'bot', text: `ä½ å¥½ï¼æˆ‘æ˜¯ PetGuard æ™ºèƒ½åŠ©æ‰‹ã€‚ä»Šæ—¥ç›‘æ§å·²è¿æ¥ã€‚æ•°æ®åˆ†ææ˜¾ç¤ºï¼š${mainPetName}ä»Šå¤©æ´»åŠ›æ»¡æ»¡ï¼Œå¥¶æ²¹åˆ™æ¯”è¾ƒå®‰é™ã€‚`, time: '11:00' },
                { 
                    id: 'insight-1', 
                    type: 'insight', 
                    title: 'æ¯å‘¨å¥åº·æ´å¯Ÿ ğŸ©º',
                    text: 'æ£€æµ‹åˆ° **å¥¶æ²¹** æœ¬å‘¨æ´»è·ƒåº¦æŒç»­èµ°ä½ (â†“15%)ã€‚å»ºè®®è¡¥å……æ–°ç©å…·ä»¥å¢åŠ è¿åŠ¨é‡ã€‚',
                    time: '11:02'
                }
            ]);

            // çŠ¶æ€å®šä¹‰
            const [activeTab, setActiveTab] = useState('home');
            const [videoUrl, setVideoUrl] = useState(CONFIG.defaultVideo);
            const [viewMode, setViewMode] = useState('live');
            const [selectedCatFilter, setSelectedCatFilter] = useState('all'); 
            const [playModal, setPlayModal] = useState({ show: false, startTime: 0, src: null }); 
            const [isAiThinking, setIsAiThinking] = useState(false);
            const [selectedDate, setSelectedDate] = useState(CONFIG.currentDate); 
            const [recordLogs, setRecordLogs] = useState(logs); 
            const [showCalendarModal, setShowCalendarModal] = useState(false); 
            const [inputMessage, setInputMessage] = useState('');
            const [pushNotification, setPushNotification] = useState(null);
            const [triggeredAlerts, setTriggeredAlerts] = useState(new Set());
            const [cameraLabel, setCameraLabel] = useState({ text: 'æ­£åœ¨è¿æ¥...', color: 'bg-blue-500' });

            const videoRef = useRef(null);
            const modalVideoRef = useRef(null);
            const [isPlaying, setIsPlaying] = useState(false);
            const [isMuted, setIsMuted] = useState(true);
            const chatContainerRef = useRef(null);

            // è§†é¢‘è„šæœ¬é€»è¾‘ (æ›¿æ¢åå­—)
            const VIDEO_SCRIPT = [
                { startTime: 0, endTime: 8, hasMotion: false, cameraStatus: { text: 'ç›‘æ§ä¸­', color: 'bg-green-500' }, boxes: [] },
                { startTime: 8, endTime: 12, hasMotion: true, cameraStatus: { text: 'è¯†åˆ«ä¸­', color: 'bg-blue-500' }, boxes: [] },
                { 
                    startTime: 12, endTime: 16, hasMotion: true, cameraStatus: { text: 'âš ï¸ å¼‚å¸¸', color: 'bg-orange-500' }, 
                    triggerAlert: { 
                        timeTrigger: CONFIG.alertTriggerTime, 
                        cat: 'åŒçŒ«', 
                        type: 'warning', 
                        action: 'æ·±å¤œè·‘é…·', 
                        title: 'æ£€æµ‹åˆ°æ·±å¤œè·‘é…·è¡Œä¸º', 
                        detail: `ã€å¤œè§†è¡Œä¸ºåˆ†æã€‘ç›‘æµ‹åˆ°å®¢å…å‘ç”Ÿæ¿€çƒˆçš„è¿½é€æ¸¸æˆã€‚${mainPetName}ç‡å…ˆå‘èµ·å†²åˆºï¼Œå¥¶æ²¹ç´§éšå…¶åã€‚AI åˆ¤å®šä¸ºé«˜èƒ½ç©è€çŠ¶æ€ã€‚`, 
                        videoTime: CONFIG.alertTriggerTime 
                    },
                    boxes: []
                },
                { startTime: 16, endTime: 100, hasMotion: false, cameraStatus: { text: 'ç›‘æ§ä¸­', color: 'bg-green-500' }, boxes: [] }
            ];

            // è‡ªåŠ¨æ’­æ”¾
            useEffect(() => {
                if (videoUrl === CONFIG.defaultVideo && videoRef.current) {
                   const timer = setTimeout(() => {
                      if(videoRef.current) {
                          videoRef.current.play()
                            .then(() => { setIsPlaying(true); setCameraLabel({ text: 'ğŸ”´', color: 'bg-green-500' }); })
                            .catch(e => { console.log("è‡ªåŠ¨æ’­æ”¾è¢«é˜»æ­¢", e); setCameraLabel({ text: 'ç‚¹å‡»æ’­æ”¾', color: 'bg-blue-500' }); });
                      }
                   }, 800);
                   return () => clearTimeout(timer);
                }
            }, []);

            // èŠå¤©è‡ªåŠ¨æ»šåŠ¨
            useEffect(() => {
                if (chatContainerRef.current) {
                  chatContainerRef.current.scrollTop = chatContainerRef.current.scrollHeight;
                }
            }, [chatMessages, activeTab]);

            // è§†é¢‘äº‹ä»¶ç›‘å¬
            useEffect(() => {
                if (!videoRef.current) return;
                const videoElement = videoRef.current;

                const handleTimeUpdate = () => {
                    const time = videoElement.currentTime;
                    const activeScript = VIDEO_SCRIPT.find(s => time >= s.startTime && time < s.endTime);

                    if (activeScript) {
                        if (activeScript.hasMotion && !playModal.show) {
                            setCameraLabel({ text: 'æ£€æµ‹åˆ°åŠ¨æ€', color: 'bg-blue-500' });
                        } else if (!playModal.show) {
                            setCameraLabel({ text: 'ğŸ”´', color: 'bg-green-500' });
                        }

                        if (activeScript.triggerAlert && Math.floor(time) === activeScript.triggerAlert.timeTrigger && !playModal.show) {
                           const alertId = `alert-${Math.floor(time)}`;
                           if (!triggeredAlerts.has(alertId)) {
                               setTriggeredAlerts(prev => new Set(prev).add(alertId));
                               setPushNotification({
                                 title: activeScript.triggerAlert.title,
                                 text: activeScript.triggerAlert.detail,
                                 videoTime: activeScript.triggerAlert.videoTime
                               });
                               setTimeout(() => setPushNotification(null), 6000); 
                               
                               const newLog = {
                                 id: Date.now(), time: '23:09', cat: activeScript.triggerAlert.cat, type: 'warning',
                                 action: activeScript.triggerAlert.action, detail: activeScript.triggerAlert.detail,
                                 videoTime: activeScript.triggerAlert.videoTime, thumbColor: 'bg-gray-800 text-white' 
                               };
                               setLogs(oldLogs => [newLog, ...oldLogs]); 

                               setChatMessages(prev => [...prev, {
                                 id: Date.now(), type: 'push', time: '23:09', alertId: alertId,
                                 title: activeScript.triggerAlert.title, text: activeScript.triggerAlert.detail,
                                 videoTime: activeScript.triggerAlert.videoTime,
                                 isHighlightCard: true
                               }]);
                           }
                        }
                    } 
                };
                videoElement.addEventListener('timeupdate', handleTimeUpdate);
                return () => videoElement.removeEventListener('timeupdate', handleTimeUpdate);
            }, [videoUrl, playModal.show, triggeredAlerts, mainPetName]); 

            // å¤„ç†è§†é¢‘å¼¹çª—
            useEffect(() => {
                if (playModal.show && modalVideoRef.current) {
                  modalVideoRef.current.currentTime = playModal.startTime;
                  modalVideoRef.current.play().catch(e => {});
                }
            }, [playModal.show]);

            // è§†é¢‘æ“ä½œ
            const handleFileUpload = (event) => {
                const file = event.target.files[0];
                if (file) {
                  const url = URL.createObjectURL(file);
                  setVideoUrl(url);
                  setTriggeredAlerts(new Set()); 
                  setTimeout(() => { if(videoRef.current) { videoRef.current.play(); setIsPlaying(true); } }, 500);
                }
            };

            const handleVideoError = () => {
                 console.log("é»˜è®¤è§†é¢‘åŠ è½½å¤±è´¥");
                 setVideoUrl(null);
            };

            const togglePlay = () => {
                if (videoRef.current) {
                  if (isPlaying) videoRef.current.pause(); else videoRef.current.play();
                  setIsPlaying(!isPlaying);
                }
            };

            const handleJumpToVideo = (time, src = null) => {
                const targetSrc = src || videoUrl;
                if (time === null || time === undefined) return;
                if (!targetSrc) return alert("è¯·å…ˆåœ¨ç›‘æ§é¡µä¸Šä¼ è§†é¢‘ï¼");
                setPlayModal({ show: true, startTime: time, src: targetSrc });
                setPushNotification(null);
            };

            // AI æ¨¡æ‹Ÿå›å¤
            const handleSendMessage = async (text = inputMessage) => {
                if (!text.trim()) return;
                const newUserMsg = { id: Date.now(), type: 'user', text: text, time: 'åˆšåˆš' };
                setChatMessages(prev => [...prev, newUserMsg]);
                setInputMessage('');
                setIsAiThinking(true);
                
                // æ¨¡æ‹Ÿå»¶è¿Ÿ
                setTimeout(() => {
                    let response = "";
                    if (text.includes("æ€»ç»“")) response = `ä»Šæ—¥æ€»ç»“ï¼š\n1. **${mainPetName}**ï¼šç²¾åŠ›æ—ºç››ï¼Œæœ‰ä¸€æ¬¡è·³æ¡Œå­è¿è§„ã€‚\n2. **å¥¶æ²¹**ï¼šå²æœˆé™å¥½ï¼Œå¤§éƒ¨åˆ†æ—¶é—´åœ¨ä¼‘æ¯ã€‚`;
                    else if (text.includes(mainPetName)) response = `**${mainPetName}**ä»Šå¤©éå¸¸æ´»è·ƒï¼Œæ—©ä¸Šè·‘é…·ï¼Œæ™šä¸Šè¿˜è·³äº†ä¸€æ¬¡æ¡Œå­ã€‚`;
                    else if (text.includes("å¥¶æ²¹")) response = `**å¥¶æ²¹**ä»Šå¤©å¾ˆè®©äººçœå¿ƒï¼Œä½†æ´»è·ƒåº¦åä½ã€‚`;
                    else if (text.includes("å»ºè®®")) response = `æ ¹æ®**å¥¶æ²¹**æœ€è¿‘çš„æ´»è·ƒåº¦æ•°æ®ï¼ˆä½è‡³28%ï¼‰ï¼Œå»ºè®®ç»™å®ƒè¡¥å……ä¸€äº›æ–°ç©å…·ã€‚${mainPetName}çš„è¯ï¼Œç°åœ¨çš„çŒ«è–„è·çƒå®ƒç©å¾—å¾ˆå¼€å¿ƒã€‚`;
                    else response = `æˆ‘æ˜¯ PetGuard æ™ºèƒ½åŠ©æ‰‹ã€‚æ‚¨å¯ä»¥é—®æˆ‘â€œ${mainPetName}ä»Šå¤©å¹²äº†ä»€ä¹ˆï¼Ÿâ€`;
                    
                    setChatMessages(prev => [...prev, { id: Date.now() + 1, type: 'bot', text: response, time: 'åˆšåˆš' }]);
                    setIsAiThinking(false);
                }, 1500);
            };

            const TabButton = ({ id, icon: Icon, label }) => (
                <button onClick={() => setActiveTab(id)} className={`flex flex-col items-center justify-center w-full py-2 transition-colors ${activeTab === id ? 'text-orange-600' : 'text-gray-400'}`}>
                  <Icon size={24} className={`mb-1 ${activeTab === id ? 'scale-110' : ''} transition-transform`} />
                  <span className="text-[10px] font-medium">{label}</span>
                </button>
            );

            return (
                <div className="bg-gray-50 h-screen font-sans text-gray-900 flex flex-col max-w-md mx-auto shadow-2xl overflow-hidden border-x border-gray-200 animate-fade-in">
                    {/* Push é€šçŸ¥ */}
                    {pushNotification && (
                        <div onClick={() => handleJumpToVideo(pushNotification.videoTime)} className="fixed top-4 left-4 right-4 bg-white/95 backdrop-blur-md rounded-2xl shadow-2xl z-[60] border-l-4 border-orange-500 p-4 animate-slide-up cursor-pointer flex items-start gap-3 ring-1 ring-black/5 max-w-md mx-auto">
                           <div className="bg-orange-100 p-2 rounded-full text-orange-600 flex-shrink-0 mt-0.5"><AlertTriangle size={20} /></div>
                           <div className="flex-1 min-w-0"><div className="flex justify-between items-start"><h4 className="font-bold text-gray-900 text-sm">PetGuard æ™ºèƒ½è­¦æŠ¥</h4><span className="text-[10px] text-gray-400">åˆšåˆš</span></div><p className="font-medium text-gray-800 text-xs mt-1 truncate">{pushNotification.title}</p><p className="text-gray-500 text-[10px] mt-0.5 line-clamp-2">{pushNotification.text}</p></div>
                        </div>
                    )}

                    {/* è§†é¢‘å›æ”¾å¼¹çª— */}
                    {playModal.show && (
                        <div className="fixed inset-0 z-50 bg-black/95 flex flex-col justify-center items-center animate-fade-in">
                          <button onClick={() => setPlayModal({ show: false, startTime: 0, src: null })} className="absolute top-4 right-4 text-white p-2 bg-white/10 rounded-full hover:bg-white/20 transition-colors z-50"><X size={24} /></button>
                          <div className="w-full aspect-video bg-black relative">
                            <video ref={modalVideoRef} src={playModal.src || videoUrl} className="w-full h-full object-contain" controls muted={isMuted} />
                          </div>
                          <div className="mt-6 text-white/90 text-sm bg-gray-800/80 px-6 py-2 rounded-full border border-white/10 flex items-center gap-2"><Sparkles size={14} className="text-yellow-400"/> äº‘ç«¯ AI åˆ†æå›æ”¾</div>
                        </div>
                    )}

                    {/* === Tab 1: é¦–é¡µ === */}
                    <div className={`flex flex-col flex-1 h-full overflow-hidden ${activeTab === 'home' ? 'block' : 'hidden'}`}>
                        {/* è§†é¢‘åŒºåŸŸ */}
                        <div className="relative bg-black w-full aspect-video flex-shrink-0 z-20 shadow-md">
                            {videoUrl ? (
                              <>
                                <video ref={videoRef} src={videoUrl} className="w-full h-full object-contain bg-black" loop muted={isMuted} playsInline onPlay={() => setIsPlaying(true)} onPause={() => setIsPlaying(false)} onError={handleVideoError} />
                                <div className="absolute top-3 left-3 flex gap-2"><div className={`flex items-center gap-1.5 px-2 py-1 rounded-md backdrop-blur-md text-[10px] font-bold text-white shadow-sm ${cameraLabel.color}`}>{cameraLabel.text === 'ğŸ”´' && <div className="w-1.5 h-1.5 rounded-full bg-white animate-pulse"></div>}{cameraLabel.text}</div></div>
                                <div className="absolute bottom-3 right-3 flex gap-2">
                                   <button onClick={() => setIsMuted(!isMuted)} className="p-1.5 bg-black/40 rounded-full text-white/80 backdrop-blur-sm hover:bg-black/60">{isMuted ? <VolumeX size={16}/> : <Volume2 size={16}/>}</button>
                                   <button onClick={togglePlay} className="p-1.5 bg-black/40 rounded-full text-white/80 backdrop-blur-sm hover:bg-black/60">{isPlaying ? <Pause size={16}/> : <Play size={16}/>}</button>
                                </div>
                              </>
                            ) : (
                              <div className="absolute inset-0 flex flex-col items-center justify-center text-gray-500 bg-gray-900">
                                <Upload size={32} className="mb-2 opacity-50"/><label className="text-xs bg-gray-800 text-gray-300 px-4 py-2 rounded-full cursor-pointer hover:bg-gray-700 transition-colors border border-gray-700">ä¸Šä¼ è§†é¢‘æº <input type="file" onChange={handleFileUpload} className="hidden" accept="video/*"/></label>
                              </div>
                            )}
                        </div>
                        
                        {/* AI åŠ©æ‰‹åŒºåŸŸ */}
                        <div className="flex-1 flex flex-col bg-gray-50 overflow-hidden relative">
                             <div className="flex-1 overflow-y-auto p-4 space-y-4" ref={chatContainerRef}>
                                {/* å® ç‰©çŠ¶æ€å¡ç‰‡ */}
                                <div className="grid grid-cols-2 gap-3 mb-2">
                                    {Object.keys(petData).map(cat => (
                                        <div key={cat} className="bg-white p-3 rounded-xl border border-gray-100 shadow-sm flex flex-col gap-2">
                                           <div className="flex items-center gap-2">
                                             <div className={`w-6 h-6 rounded-full flex items-center justify-center text-[10px] font-bold ${petData[cat].avatarColor.split(' ')[0]} ${petData[cat].avatarColor.split(' ')[1]}`}>{cat[0]}</div>
                                             <span className="font-bold text-xs text-gray-800">{cat}</span>
                                           </div>
                                           <div>
                                             <div className="flex justify-between text-[10px] text-gray-400 mb-1"><span>æ´»è·ƒåº¦</span><span className="font-bold text-gray-600">{petData[cat].activeLevel}%</span></div>
                                             <div className="w-full bg-gray-100 h-1 rounded-full overflow-hidden"><div className={`h-full rounded-full ${cat === mainPetName ? 'bg-orange-400' : 'bg-yellow-400'}`} style={{ width: `${petData[cat].activeLevel}%` }}></div></div>
                                           </div>
                                           <div className="flex items-center justify-between bg-gray-50 px-2 py-1 rounded text-[10px] text-gray-500"><div className="flex items-center gap-1"><Utensils size={10}/> {petData[cat].eatCount}</div><div className="flex items-center gap-1"><Droplets size={10}/> {petData[cat].drinkCount}</div></div>
                                        </div>
                                    ))}
                                </div>

                                {/* æ¶ˆæ¯åˆ—è¡¨ */}
                                {chatMessages.map(msg => (
                                  <div key={msg.id} className={`flex flex-col animate-fade-in ${msg.type === 'user' ? 'items-end' : 'items-start'}`}>
                                     <div className={`flex max-w-[90%] ${msg.type === 'user' ? 'flex-row-reverse' : 'flex-row'} items-end gap-2`}>
                                        {msg.type !== 'user' && <div className={`w-8 h-8 rounded-full flex-shrink-0 flex items-center justify-center shadow-sm ${msg.type === 'push' ? 'bg-orange-100 text-orange-600' : msg.type === 'insight' ? 'bg-blue-100 text-blue-600' : 'bg-white text-indigo-600 border border-gray-100'}`}>{msg.type === 'push' ? <AlertTriangle size={16}/> : msg.type === 'insight' ? <Lightbulb size={16}/> : <Bot size={18}/>}</div>}
                                        <div className={`relative px-4 py-3 text-sm shadow-sm ${msg.type === 'user' ? 'bg-indigo-600 text-white rounded-2xl rounded-br-sm' : msg.isHighlightCard ? 'w-full p-0 bg-transparent shadow-none' : msg.type === 'push' ? 'bg-white border-l-4 border-orange-500 rounded-r-2xl rounded-bl-2xl' : msg.type === 'insight' ? 'bg-blue-50 border-l-4 border-blue-500 text-gray-800 rounded-r-2xl rounded-bl-2xl' : 'bg-white text-gray-800 rounded-2xl rounded-bl-sm border border-gray-100'}`}>
                                            {msg.isHighlightCard ? (
                                              <div className="bg-white rounded-xl overflow-hidden border border-orange-200 shadow-md w-64">
                                                 <div className="h-32 bg-orange-100 relative group cursor-pointer" onClick={() => handleJumpToVideo(msg.videoTime)}><div className="absolute inset-0 flex items-center justify-center"><div className="bg-white/30 backdrop-blur-md p-3 rounded-full shadow-lg"><Play className="text-orange-600 fill-current ml-1" size={24}/></div></div><div className="absolute bottom-2 left-2 right-2 flex justify-between items-center text-[10px] text-orange-800 font-medium"><span className="bg-white/80 px-2 py-0.5 rounded-full backdrop-blur-sm">âš ï¸ å¼‚å¸¸è¡Œä¸ºæ£€æµ‹</span><span>23:09</span></div></div>
                                                 <div className="p-3"><h4 className="font-bold text-gray-800 text-sm mb-1">{msg.title}</h4><p className="text-xs text-gray-600 leading-relaxed">{msg.text}</p></div>
                                              </div>
                                            ) : (
                                              <>
                                                 {msg.title && <div className="font-bold mb-1 flex items-center gap-1">{msg.title}</div>}
                                                 <div className="leading-relaxed whitespace-pre-wrap">{formatText(msg.text)}</div>
                                                 <div className={`text-[10px] mt-1 text-right ${msg.type === 'user' ? 'text-indigo-200' : 'text-gray-400'}`}>{msg.time}</div>
                                              </>
                                            )}
                                        </div>
                                     </div>
                                  </div>
                                ))}
                                {isAiThinking && <div className="flex justify-start items-center ml-10 animate-pulse"><div className="bg-white border border-gray-100 rounded-full px-4 py-2 flex items-center gap-2 shadow-sm"><Loader2 size={14} className="animate-spin text-indigo-500"/><span className="text-xs text-gray-500 font-medium">PetGuard æ­£åœ¨åˆ†æ...</span></div></div>}
                             </div>
                             
                             {/* è¾“å…¥åŒº */}
                             <div className="p-3 bg-white border-t border-gray-100 shadow-lg z-30">
                                <div className="flex gap-2 overflow-x-auto pb-3 mb-1 scrollbar-hide">
                                    <button onClick={() => handleSendMessage(`æ€»ç»“ä¸€ä¸‹${mainPetName}ä»Šå¤©çš„è¡¨ç°`)} className="flex-shrink-0 px-3 py-1.5 bg-gray-50 border border-gray-200 rounded-full text-xs text-gray-600 hover:bg-orange-50 hover:text-orange-600 hover:border-orange-200 transition-all font-medium shadow-sm">ğŸ± æ€»ç»“{mainPetName}è¡¨ç°</button>
                                    <button onClick={() => handleSendMessage('å¥¶æ²¹ä»Šå¤©è¿åŠ¨é‡å¤§å—ï¼Ÿ')} className="flex-shrink-0 px-3 py-1.5 bg-gray-50 border border-gray-200 rounded-full text-xs text-gray-600 hover:bg-orange-50 hover:text-orange-600 hover:border-orange-200 transition-all font-medium shadow-sm">ğŸ¦ å¥¶æ²¹è¿åŠ¨é‡</button>
                                </div>
                                <div className="flex gap-2 items-center"><input type="text" value={inputMessage} onChange={(e) => setInputMessage(e.target.value)} onKeyPress={(e) => e.key === 'Enter' && handleSendMessage()} placeholder="å’Œçˆ±å® ç®¡å®¶èŠèŠå§..." className="flex-1 bg-gray-100 rounded-full px-5 py-2.5 text-sm focus:outline-none focus:ring-2 focus:ring-orange-500/50 focus:bg-white transition-all text-gray-700 placeholder-gray-400"/><button onClick={() => handleSendMessage()} className={`bg-orange-500 text-white p-2.5 rounded-full hover:bg-orange-600 transition-all shadow-md active:scale-95 ${isAiThinking ? 'opacity-50 cursor-not-allowed' : ''}`} disabled={isAiThinking}><Send size={18} /></button></div>
                             </div>
                        </div>
                    </div>

                    {/* === Tab 2: æ—¥æŠ¥ === */}
                    {activeTab === 'timeline' && (
                        <div className="p-4 flex-1 overflow-y-auto bg-gray-50 pb-20">
                          <div className="flex items-center justify-between mb-6 pt-2"><h2 className="text-xl font-bold text-gray-800">æ¯æ—¥å–µè®°</h2><div className="flex bg-white rounded-lg p-1 shadow-sm border border-gray-100">{['all', mainPetName, 'å¥¶æ²¹'].map(filter => <button key={filter} onClick={() => setSelectedCatFilter(filter)} className={`px-3 py-1 text-xs rounded-md transition-all ${selectedCatFilter === filter ? 'bg-orange-100 text-orange-700 font-bold' : 'text-gray-500 hover:text-gray-700'}`}>{filter === 'all' ? 'å…¨éƒ¨' : filter}</button>)}</div></div>
                          <div className="mb-8 space-y-4">
                              {(selectedCatFilter === 'all' || selectedCatFilter === mainPetName) && <div className="bg-white p-5 rounded-2xl border border-orange-100 shadow-sm relative overflow-hidden group hover:shadow-md transition-shadow"><div className="absolute top-0 right-0 p-3 opacity-10"><Sparkles className="text-orange-500" size={50}/></div><div className="flex items-center gap-2 mb-2"><div className="w-6 h-6 rounded-full bg-gray-200 flex items-center justify-center text-xs font-bold text-gray-600">{mainPetName[0]}</div><span className="font-bold text-gray-800">{mainPetName}</span></div><div className="text-sm text-gray-600 leading-relaxed whitespace-pre-line pl-1">{formatText(petData[mainPetName].report)}</div><div className="mt-4 pt-3 border-t border-orange-50 flex items-start gap-2"><div className="bg-orange-100 p-1.5 rounded-full text-orange-600 mt-0.5"><Lightbulb size={14}/></div><p className="text-xs text-gray-500 leading-relaxed">{petData[mainPetName].insight}</p></div></div>}
                              {(selectedCatFilter === 'all' || selectedCatFilter === 'å¥¶æ²¹') && <div className="bg-white p-5 rounded-2xl border border-yellow-100 shadow-sm relative overflow-hidden group hover:shadow-md transition-shadow"><div className="absolute top-0 right-0 p-3 opacity-10"><Moon className="text-yellow-500" size={50}/></div><div className="flex items-center gap-2 mb-2"><div className="w-6 h-6 rounded-full bg-yellow-100 flex items-center justify-center text-xs font-bold text-yellow-700">å¥¶</div><span className="font-bold text-gray-800">å¥¶æ²¹</span></div><div className="text-sm text-gray-600 leading-relaxed whitespace-pre-line pl-1">{formatText(petData['å¥¶æ²¹'].report)}</div><div className="mt-4 pt-3 border-t border-yellow-50 flex items-start gap-2"><div className="bg-yellow-100 p-1.5 rounded-full text-yellow-700 mt-0.5"><ShoppingBag size={14}/></div><p className="text-xs text-gray-500 leading-relaxed">{formatText(petData['å¥¶æ²¹'].insight)}</p></div></div>}
                          </div>
                          <h3 className="text-sm font-bold text-gray-400 mb-4 uppercase tracking-wider">ä»Šæ—¥æ—¶é—´è½´</h3>
                          <div className="space-y-6 relative before:absolute before:left-[15px] before:top-2 before:bottom-0 before:w-0.5 before:bg-gray-200">
                              {logs.filter(log => selectedCatFilter === 'all' || log.cat.includes(selectedCatFilter) || (log.cat === 'åŒçŒ«' && selectedCatFilter !== 'all')).map(log => (
                                <div key={log.id} className="relative pl-8 group">
                                  <div className={`absolute left-0 top-3 w-8 h-8 rounded-full border-4 border-gray-50 shadow-sm flex items-center justify-center z-10 transition-colors ${log.type === 'warning' ? 'bg-orange-500 text-white' : 'bg-white text-gray-400 group-hover:border-orange-100 group-hover:text-orange-400'}`}>{log.type === 'warning' ? <AlertTriangle size={14}/> : <Clock size={14}/>}</div>
                                  <div className="bg-white rounded-xl p-3 shadow-sm border border-gray-100 flex gap-4 hover:shadow-md transition-all">
                                     <div className={`w-24 h-16 rounded-lg flex-shrink-0 relative overflow-hidden group/img cursor-pointer ${log.thumbColor}`} onClick={() => handleJumpToVideo(log.videoTime, log.videoSrc)}><div className="absolute inset-0 flex items-center justify-center text-gray-400 opacity-50">{log.videoTime !== null ? <Film size={20}/> : <VolumeX size={20}/>}</div>{log.videoTime !== null && <div className="absolute inset-0 bg-black/30 flex items-center justify-center opacity-0 group-hover/img:opacity-100 transition-opacity"><ZoomIn size={20} className="text-white drop-shadow-md"/></div>}</div>
                                     <div className="flex-1 py-0.5"><div className="flex justify-between items-start mb-1"><span className="font-bold text-sm text-gray-800">{log.action}</span><span className="text-xs text-gray-400 font-mono">{log.time}</span></div><p className="text-xs text-gray-500 line-clamp-2 leading-relaxed mb-2">{log.detail}</p><div className="flex gap-2"><span className="text-[10px] bg-gray-50 border border-gray-100 px-2 py-0.5 rounded text-gray-500">{log.cat}</span>{log.videoTime !== null && <span className="text-[10px] bg-blue-50 text-blue-600 px-2 py-0.5 rounded flex items-center gap-1 font-medium cursor-pointer" onClick={() => handleJumpToVideo(log.videoTime, log.videoSrc)}><PlayCircle size={10}/> æŸ¥çœ‹å›æ”¾</span>}</div></div>
                                  </div>
                                </div>
                              ))}
                          </div>
                        </div>
                    )}

                    {/* === Tab 4: è®¾ç½® === */}
                    {activeTab === 'settings' && (
                        <div className="flex-1 bg-gray-50 overflow-y-auto pb-20">
                           <div className="bg-white px-6 py-8 border-b border-gray-100"><h2 className="text-2xl font-bold text-gray-900 mb-1">è®¾ç½®</h2><p className="text-sm text-gray-500">ç®¡ç†æ‚¨çš„è®¾å¤‡ä¸å® ç‰©æ¡£æ¡ˆ</p></div>
                           <div className="p-4 space-y-6">
                              <section>
                                 <div className="flex justify-between items-center mb-3 px-1"><h3 className="text-sm font-bold text-gray-700 uppercase tracking-wide">æˆ‘çš„å® ç‰©</h3><button className="text-xs text-orange-600 font-medium hover:text-orange-700">æ·»åŠ å® ç‰©</button></div>
                                 <div className="space-y-3">{Object.keys(petData).map(cat => <div key={cat} className="bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex items-center justify-between group cursor-pointer hover:border-orange-200 transition-colors"><div className="flex items-center gap-4"><div className={`w-12 h-12 rounded-full flex items-center justify-center text-lg font-bold shadow-inner ${petData[cat].avatarColor}`}>{cat[0]}</div><div><div className="font-bold text-gray-900">{cat}</div><div className="text-xs text-gray-500 mt-0.5">{petData[cat].type} Â· {petData[cat].weight}</div></div></div><div className="bg-gray-50 p-2 rounded-full text-gray-400 group-hover:bg-orange-50 group-hover:text-orange-500 transition-colors"><Edit2 size={16}/></div></div>)}</div>
                              </section>
                              <section>
                                 <h3 className="text-sm font-bold text-gray-700 uppercase tracking-wide mb-3 px-1">è®¾å¤‡çŠ¶æ€</h3>
                                 <div className="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden"><div className="p-4 flex items-center justify-between border-b border-gray-50"><div className="flex items-center gap-3"><div className="bg-blue-50 p-2 rounded-lg text-blue-600"><Camera size={20}/></div><div><div className="text-sm font-bold text-gray-900">PetGuard Pro</div><div className="text-xs text-gray-500">å›ºä»¶ v2.4.1 (æœ€æ–°)</div></div></div><div className="flex items-center gap-1 text-green-500 bg-green-50 px-2 py-1 rounded text-xs font-medium"><div className="w-1.5 h-1.5 rounded-full bg-green-500"></div> åœ¨çº¿</div></div><div className="grid grid-cols-2 divide-x divide-gray-50"><div className="p-3 flex items-center justify-center gap-2 text-sm text-gray-600"><Wifi size={16} className="text-gray-400"/> ä¿¡å·å¼º</div><div className="p-3 flex items-center justify-center gap-2 text-sm text-gray-600"><Battery size={16} className="text-gray-400"/> æ¥é€šç”µæº</div></div></div>
                              </section>
                              <section>
                                 <h3 className="text-sm font-bold text-gray-700 uppercase tracking-wide mb-3 px-1">é€šç”¨</h3>
                                 <div className="bg-white rounded-xl shadow-sm border border-gray-100 divide-y divide-gray-50"><div className="p-4 flex items-center justify-between cursor-pointer hover:bg-gray-50"><div className="flex items-center gap-3"><div className="bg-orange-50 p-2 rounded-lg text-orange-600"><Bell size={18}/></div><span className="text-sm font-medium text-gray-700">æ™ºèƒ½é€šçŸ¥æ¨é€</span></div><div className="w-10 h-6 bg-orange-500 rounded-full relative"><div className="absolute top-1 right-1 w-4 h-4 bg-white rounded-full shadow-sm"></div></div></div><div className="p-4 flex items-center justify-between cursor-pointer hover:bg-gray-50"><div className="flex items-center gap-3"><div className="bg-purple-50 p-2 rounded-lg text-purple-600"><Shield size={18}/></div><span className="text-sm font-medium text-gray-700">éšç§ä¿æŠ¤æ¨¡å¼</span></div><ChevronRight size={16} className="text-gray-400"/></div></div>
                              </section>
                              <div className="text-center text-xs text-gray-400 py-4">PetGuard App v1.0.0 (Beta)</div>
                           </div>
                        </div>
                    )}

                    {/* åº•éƒ¨å¯¼èˆª */}
                    <div className="fixed bottom-0 left-0 right-0 bg-white/95 backdrop-blur-xl border-t border-gray-200 flex justify-around items-center px-6 pb-safe pt-1 max-w-md mx-auto z-40 h-[65px] shadow-[0_-1px_10px_rgba(0,0,0,0.02)]">
                        <TabButton id="home" icon={Camera} label="é¦–é¡µ" />
                        <TabButton id="timeline" icon={Activity} label="æ—¥æŠ¥" />
                        <TabButton id="settings" icon={Settings} label="è®¾ç½®" />
                    </div>
                </div>
            );
        };

        // ==========================================
        // ğŸ”µ æ ¹ç»„ä»¶ï¼šæ§åˆ¶æ•´ä½“æµç¨‹
        // ==========================================
        const PetGuardApp = () => {
            const [isOnboarded, setIsOnboarded] = useState(false);
            const [userPetData, setUserPetData] = useState(null);

            const handleOnboardingComplete = (data) => {
                setUserPetData(data);
                setIsOnboarded(true);
            };

            if (!isOnboarded) {
                return <Onboarding onComplete={handleOnboardingComplete} />;
            }
            return <Dashboard userData={userPetData} />;
        };

        const root = createRoot(document.getElementById('root'));
        root.render(<PetGuardApp />);
    </script>
</body>
</html>
